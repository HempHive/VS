{
  "name": "martin - pixies party filth edition",
  "description": "martin - pixies party filth edition",
  "milkdrop_raw": "MILKDROP_PRESET_VERSION=201\r\nPSVERSION=3\r\nPSVERSION_WARP=3\r\nPSVERSION_COMP=3\r\n[preset00]\r\nfRating=5.000000\r\nfGammaAdj=1.980\r\nfDecay=0.500\r\nfVideoEchoZoom=0.952\r\nfVideoEchoAlpha=0.500\r\nnVideoEchoOrientation=3\r\nnWaveMode=0\r\nbAdditiveWaves=1\r\nbWaveDots=0\r\nbWaveThick=1\r\nbModWaveAlphaByVolume=1\r\nbMaximizeWaveColor=0\r\nbTexWrap=1\r\nbDarkenCenter=0\r\nbRedBlueStereo=0\r\nbBrighten=0\r\nbDarken=1\r\nbSolarize=0\r\nbInvert=0\r\nfWaveAlpha=0.001\r\nfWaveScale=0.029\r\nfWaveSmoothing=0.450\r\nfWaveParam=0.000\r\nfModWaveAlphaStart=0.000\r\nfModWaveAlphaEnd=1.320\r\nfWarpAnimSpeed=1.459\r\nfWarpScale=2.007\r\nfZoomExponent=1.00000\r\nfShader=0.000\r\nzoom=0.99990\r\nrot=0.00000\r\ncx=0.500\r\ncy=0.500\r\ndx=0.00000\r\ndy=0.00000\r\nwarp=0.01000\r\nsx=0.99990\r\nsy=1.00000\r\nwave_r=0.000\r\nwave_g=0.000\r\nwave_b=0.000\r\nwave_x=0.500\r\nwave_y=0.500\r\nob_size=0.050\r\nob_r=0.000\r\nob_g=0.000\r\nob_b=0.000\r\nob_a=0.000\r\nib_size=0.260\r\nib_r=0.250\r\nib_g=0.250\r\nib_b=0.250\r\nib_a=0.000\r\nnMotionVectorsX=19.200\r\nnMotionVectorsY=19.200\r\nmv_dx=0.000\r\nmv_dy=0.000\r\nmv_l=1.850\r\nmv_r=0.500\r\nmv_g=0.500\r\nmv_b=0.500\r\nmv_a=0.000\r\nb1n=0.000\r\nb2n=0.000\r\nb3n=0.000\r\nb1x=1.000\r\nb2x=0.700\r\nb3x=0.500\r\nb1ed=0.000\r\nwavecode_0_enabled=1\r\nwavecode_0_samples=512\r\nwavecode_0_sep=20\r\nwavecode_0_bSpectrum=1\r\nwavecode_0_bUseDots=1\r\nwavecode_0_bDrawThick=0\r\nwavecode_0_bAdditive=1\r\nwavecode_0_scaling=0.29460\r\nwavecode_0_smoothing=0.10000\r\nwavecode_0_r=1.000\r\nwavecode_0_g=0.300\r\nwavecode_0_b=1.000\r\nwavecode_0_a=0.600\r\nwave_0_init1=t0 = 0;\r\nwave_0_per_frame1=t1 = 0;\r\nwave_0_per_point1=self = t1*reg01 + 100000; //#\r\nwave_0_per_point2=\r\nwave_0_per_point3=age = gmegabuf(self+12);\r\nwave_0_per_point4=max_age = reg22;\r\nwave_0_per_point5=if (age > 0,\r\nwave_0_per_point6=  x0 = gmegabuf(self)-reg07;\r\nwave_0_per_point7=  y0 = gmegabuf(self+1)-reg08;\r\nwave_0_per_point8=  z0 = gmegabuf(self+2)-reg09;\r\nwave_0_per_point9=\r\nwave_0_per_point10=\r\nwave_0_per_point11=  x1 = x0*reg30 + y0*reg31 + z0*reg32;\r\nwave_0_per_point12=  y1 = x0*reg33 + y0*reg34 + z0*reg35;\r\nwave_0_per_point13=  z1 = x0*reg36 + y0*reg37 + z0*reg38;\r\nwave_0_per_point14=\r\nwave_0_per_point15=\r\nwave_0_per_point16=  if (z1 > 0,\r\nwave_0_per_point17=    a = min(1,.03/z1)* max(0,1-age/max_age); //###\r\nwave_0_per_point18=    r = gmegabuf(self+9);\r\nwave_0_per_point19=    g = gmegabuf(self+10);\r\nwave_0_per_point20=    b = gmegabuf(self+11);\r\nwave_0_per_point21=    fac = reg19;;\r\nwave_0_per_point22=    x = .5 + x1/z1*fac;\r\nwave_0_per_point23=    y = .5 - y1/z1*fac;\r\nwave_0_per_point24=  ,gmegabuf(self+12) += 4*q30; a= 0; ); //#age prematurely ?);\r\nwave_0_per_point25=\r\nwave_0_per_point26=, a=0; ) ;\r\nwave_0_per_point27=\r\nwave_0_per_point28=t1 += 1;\r\nwavecode_1_enabled=1\r\nwavecode_1_samples=512\r\nwavecode_1_sep=0\r\nwavecode_1_bSpectrum=0\r\nwavecode_1_bUseDots=1\r\nwavecode_1_bDrawThick=0\r\nwavecode_1_bAdditive=1\r\nwavecode_1_scaling=0.14869\r\nwavecode_1_smoothing=0.82000\r\nwavecode_1_r=1.000\r\nwavecode_1_g=1.000\r\nwavecode_1_b=1.000\r\nwavecode_1_a=0.100\r\nwave_1_per_frame1=t1 = samples;\r\nwave_1_per_point1=self = t1*reg01 + 100000; //#\r\nwave_1_per_point2=\r\nwave_1_per_point3=age = gmegabuf(self+12);\r\nwave_1_per_point4=max_age = reg22;\r\nwave_1_per_point5=if (age > 0,\r\nwave_1_per_point6=  x0 = gmegabuf(self)-reg07;\r\nwave_1_per_point7=  y0 = gmegabuf(self+1)-reg08;\r\nwave_1_per_point8=  z0 = gmegabuf(self+2)-reg09;\r\nwave_1_per_point9=\r\nwave_1_per_point10=\r\nwave_1_per_point11=  x1 = x0*reg30 + y0*reg31 + z0*reg32;\r\nwave_1_per_point12=  y1 = x0*reg33 + y0*reg34 + z0*reg35;\r\nwave_1_per_point13=  z1 = x0*reg36 + y0*reg37 + z0*reg38;\r\nwave_1_per_point14=\r\nwave_1_per_point15=\r\nwave_1_per_point16=  if (z1 > 0,\r\nwave_1_per_point17=    a = min(1,.03/z1)* max(0,1-age/max_age); //###\r\nwave_1_per_point18=    r = gmegabuf(self+9);\r\nwave_1_per_point19=    g = gmegabuf(self+10);\r\nwave_1_per_point20=    b = gmegabuf(self+11);\r\nwave_1_per_point21=    fac = reg19;;\r\nwave_1_per_point22=    x = .5 + x1/z1*fac;\r\nwave_1_per_point23=    y = .5 - y1/z1*fac;\r\nwave_1_per_point24=  ,gmegabuf(self+12) += 4*q30; a= 0; ); //#age prematurely ?);\r\nwave_1_per_point25=\r\nwave_1_per_point26=, a=0; ) ;\r\nwave_1_per_point27=\r\nwave_1_per_point28=t1 += 1;\r\nwavecode_2_enabled=1\r\nwavecode_2_samples=512\r\nwavecode_2_sep=0\r\nwavecode_2_bSpectrum=1\r\nwavecode_2_bUseDots=1\r\nwavecode_2_bDrawThick=0\r\nwavecode_2_bAdditive=1\r\nwavecode_2_scaling=0.89152\r\nwavecode_2_smoothing=0.82000\r\nwavecode_2_r=1.000\r\nwavecode_2_g=1.000\r\nwavecode_2_b=1.000\r\nwavecode_2_a=1.000\r\nwave_2_per_frame1=t1 = samples*2;\r\nwave_2_per_point1=self = t1*reg01 + 100000; //#\r\nwave_2_per_point2=\r\nwave_2_per_point3=age = gmegabuf(self+12);\r\nwave_2_per_point4=max_age = reg22;\r\nwave_2_per_point5=if (age > 0,\r\nwave_2_per_point6=  x0 = gmegabuf(self)-reg07;\r\nwave_2_per_point7=  y0 = gmegabuf(self+1)-reg08;\r\nwave_2_per_point8=  z0 = gmegabuf(self+2)-reg09;\r\nwave_2_per_point9=\r\nwave_2_per_point10=\r\nwave_2_per_point11=  x1 = x0*reg30 + y0*reg31 + z0*reg32;\r\nwave_2_per_point12=  y1 = x0*reg33 + y0*reg34 + z0*reg35;\r\nwave_2_per_point13=  z1 = x0*reg36 + y0*reg37 + z0*reg38;\r\nwave_2_per_point14=\r\nwave_2_per_point15=\r\nwave_2_per_point16=  if (z1 > 0,\r\nwave_2_per_point17=    a = min(1,.03/z1)* max(0,1-age/max_age); //###\r\nwave_2_per_point18=    r = gmegabuf(self+9);\r\nwave_2_per_point19=    g = gmegabuf(self+10);\r\nwave_2_per_point20=    b = gmegabuf(self+11);\r\nwave_2_per_point21=    fac = reg19;;\r\nwave_2_per_point22=    x = .5 + x1/z1*fac;\r\nwave_2_per_point23=    y = .5 - y1/z1*fac;\r\nwave_2_per_point24=  ,gmegabuf(self+12) += 4*q30; a= 0; ); //#age prematurely ?);\r\nwave_2_per_point25=\r\nwave_2_per_point26=, a=0; ) ;\r\nwave_2_per_point27=\r\nwave_2_per_point28=t1 += 1;\r\nwavecode_3_enabled=1\r\nwavecode_3_samples=512\r\nwavecode_3_sep=0\r\nwavecode_3_bSpectrum=1\r\nwavecode_3_bUseDots=1\r\nwavecode_3_bDrawThick=0\r\nwavecode_3_bAdditive=1\r\nwavecode_3_scaling=1.22018\r\nwavecode_3_smoothing=0.20000\r\nwavecode_3_r=1.000\r\nwavecode_3_g=1.000\r\nwavecode_3_b=1.000\r\nwavecode_3_a=1.000\r\nwave_3_per_frame1=t1 = samples*3;\r\nwave_3_per_point1=self = t1*reg01 + 100000; //#\r\nwave_3_per_point2=\r\nwave_3_per_point3=age = gmegabuf(self+12);\r\nwave_3_per_point4=max_age = reg22;\r\nwave_3_per_point5=if (age > 0,\r\nwave_3_per_point6=  x0 = gmegabuf(self)-reg07;\r\nwave_3_per_point7=  y0 = gmegabuf(self+1)-reg08;\r\nwave_3_per_point8=  z0 = gmegabuf(self+2)-reg09;\r\nwave_3_per_point9=\r\nwave_3_per_point10=\r\nwave_3_per_point11=  x1 = x0*reg30 + y0*reg31 + z0*reg32;\r\nwave_3_per_point12=  y1 = x0*reg33 + y0*reg34 + z0*reg35;\r\nwave_3_per_point13=  z1 = x0*reg36 + y0*reg37 + z0*reg38;\r\nwave_3_per_point14=\r\nwave_3_per_point15=\r\nwave_3_per_point16=  if (z1 > 0,\r\nwave_3_per_point17=    a = min(1,.03/z1)* max(0,1-age/max_age); //###\r\nwave_3_per_point18=    r = gmegabuf(self+9);\r\nwave_3_per_point19=    g = gmegabuf(self+10);\r\nwave_3_per_point20=    b = gmegabuf(self+11);\r\nwave_3_per_point21=    fac = reg19;;\r\nwave_3_per_point22=    x = .5 + x1/z1*fac;\r\nwave_3_per_point23=    y = .5 - y1/z1*fac;\r\nwave_3_per_point24=  ,gmegabuf(self+12) += 4*q30; a= 0; ); //#age prematurely ?);\r\nwave_3_per_point25=\r\nwave_3_per_point26=, a=0; ) ;\r\nwave_3_per_point27=\r\nwave_3_per_point28=t1 += 1;\r\nshapecode_0_enabled=1\r\nshapecode_0_sides=12\r\nshapecode_0_additive=0\r\nshapecode_0_thickOutline=0\r\nshapecode_0_textured=0\r\nshapecode_0_num_inst=92\r\nshapecode_0_x=0.800\r\nshapecode_0_y=0.500\r\nshapecode_0_rad=0.02705\r\nshapecode_0_ang=1.57080\r\nshapecode_0_tex_ang=1.25664\r\nshapecode_0_tex_zoom=3.07268\r\nshapecode_0_r=1.000\r\nshapecode_0_g=1.000\r\nshapecode_0_b=1.000\r\nshapecode_0_a=1.000\r\nshapecode_0_r2=0.000\r\nshapecode_0_g2=0.000\r\nshapecode_0_b2=0.000\r\nshapecode_0_a2=0.000\r\nshapecode_0_border_r=1.000\r\nshapecode_0_border_g=0.000\r\nshapecode_0_border_b=0.000\r\nshapecode_0_border_a=0.000\r\nshape_0_per_frame1=t1 = time - int (time);\r\nshape_0_per_frame2=sample = instance/num_inst;\r\nshape_0_per_frame3=t_abs = sample*3;\r\nshape_0_per_frame4=t_rel = sample-time/5;\r\nshape_0_per_frame5=\r\nshape_0_per_frame6=ampl = 2*t_abs/2 ;\r\nshape_0_per_frame7=\r\nshape_0_per_frame8=k1=sin(time/13);\r\nshape_0_per_frame9=k2=sin(time/12);\r\nshape_0_per_frame10=ox = ampl*sin (t_abs*(31+5*k1)) + sin(time/25)*(1-t_abs)*0.4  ;\r\nshape_0_per_frame11=oy = ampl*cos (t_abs*(31+5*k2));\r\nshape_0_per_frame12=oz = -1  ;\r\nshape_0_per_frame13=\r\nshape_0_per_frame14=\r\nshape_0_per_frame15=r = sqr(sin(t_rel*3.4));\r\nshape_0_per_frame16=g = sqr(sin(t_rel));\r\nshape_0_per_frame17=b = sqr (cos(t_rel*1.8));\r\nshape_0_per_frame18=\r\nshape_0_per_frame19=//a=(0.1*(sin(t_abs*3)) + 0.6*q3*below (abs(1-t_abs-t1 ),0.3))*a;\r\nshape_0_per_frame20=\r\nshape_0_per_frame21=xang = time/9.5;\r\nshape_0_per_frame22=yang = 0*time/7;\r\nshape_0_per_frame23=zang = -time/22;\r\nshape_0_per_frame24=fov = 0.5;\r\nshape_0_per_frame25=\r\nshape_0_per_frame26=\r\nshape_0_per_frame27=// Rotation um x,y,z\r\nshape_0_per_frame28=\r\nshape_0_per_frame29=mx = ox*cos(zang) - oy*sin(zang);\r\nshape_0_per_frame30=my = ox*sin(zang) + oy*cos(zang);\r\nshape_0_per_frame31=\r\nshape_0_per_frame32=ox = mx;\r\nshape_0_per_frame33=oy = my;\r\nshape_0_per_frame34=mx = ox*cos(yang) + oz*sin(yang);\r\nshape_0_per_frame35=mz = - ox*sin(yang) + oz*cos(yang);\r\nshape_0_per_frame36=ox = mx;\r\nshape_0_per_frame37=oz = mz;\r\nshape_0_per_frame38=my = oy*cos(xang) - oz*sin(xang);\r\nshape_0_per_frame39=mz = oy*sin(xang) + oz*cos(xang);\r\nshape_0_per_frame40=oy = my;\r\nshape_0_per_frame41=oz = mz;\r\nshape_0_per_frame42=\r\nshape_0_per_frame43=oz = oz - 6;\r\nshape_0_per_frame44=x = ox*fov/oz +0.5;\r\nshape_0_per_frame45=//x = (x-.5)*0.75 + 0.5;\r\nshape_0_per_frame46=y = oy*fov/oz + 0.5;\r\nshape_0_per_frame47=\r\nshape_0_per_frame48=a=1/mz*.5;\r\nshape_0_per_frame49=//a2=1/mz*.5;\r\nshape_0_per_frame50=//border_a=1/mz*.5;\r\nshape_0_per_frame51=rad=1/mz*.005;\r\nshapecode_1_enabled=1\r\nshapecode_1_sides=9\r\nshapecode_1_additive=0\r\nshapecode_1_thickOutline=0\r\nshapecode_1_textured=0\r\nshapecode_1_num_inst=800\r\nshapecode_1_x=0.260\r\nshapecode_1_y=0.200\r\nshapecode_1_rad=0.01000\r\nshapecode_1_ang=0.00000\r\nshapecode_1_tex_ang=0.00000\r\nshapecode_1_tex_zoom=0.93550\r\nshapecode_1_r=1.000\r\nshapecode_1_g=0.500\r\nshapecode_1_b=0.000\r\nshapecode_1_a=1.000\r\nshapecode_1_r2=0.000\r\nshapecode_1_g2=0.000\r\nshapecode_1_b2=0.000\r\nshapecode_1_a2=0.000\r\nshapecode_1_border_r=0.000\r\nshapecode_1_border_g=0.700\r\nshapecode_1_border_b=0.800\r\nshapecode_1_border_a=0.000\r\nshape_1_per_frame1=self = instance*reg01 + reg13;\r\nshape_1_per_frame2=\r\nshape_1_per_frame3=age = gmegabuf(self+12);\r\nshape_1_per_frame4=if (age > 0,\r\nshape_1_per_frame5=  x0 = gmegabuf(self)-reg07;\r\nshape_1_per_frame6=  y0 = gmegabuf(self+1)-reg08;\r\nshape_1_per_frame7=  z0 = gmegabuf(self+2)-reg09;\r\nshape_1_per_frame8=  size = gmegabuf(self+13);\r\nshape_1_per_frame9=\r\nshape_1_per_frame10=  x1 = x0*reg30 + y0*reg31 + z0*reg32;\r\nshape_1_per_frame11=  y1 = x0*reg33 + y0*reg34 + z0*reg35;\r\nshape_1_per_frame12=  z1 = x0*reg36 + y0*reg37 + z0*reg38;\r\nshape_1_per_frame13=\r\nshape_1_per_frame14=  if (z1 > 0, \r\nshape_1_per_frame15=    fac = reg19;;\r\nshape_1_per_frame16=    x = .5 + x1/z1*fac*q31;\r\nshape_1_per_frame17=    y = .5 - y1/z1*fac*q32;\r\nshape_1_per_frame18=    a = max(0,min(1,1-1*age/reg12)) ;\r\nshape_1_per_frame19=   \r\nshape_1_per_frame20=    rad = .0006/z1*size*(1+ pow(1-age,6)+3*age/reg12);\r\nshape_1_per_frame21=  \r\nshape_1_per_frame22=    rad = min(rad,.1);\r\nshape_1_per_frame23=    r = min(1,a*4); g = a; b = pow(a,5); \r\nshape_1_per_frame24=    a *= .35; a2 = a*.3;\r\nshape_1_per_frame25=  ,gmegabuf(self+12)+=q30; rad= 0); //#age prematurely ?\r\nshape_1_per_frame26=\r\nshape_1_per_frame27=, a=0; rad =0);\r\nshape_1_per_frame28=\r\nshape_1_per_frame29=//if (instance == reg14-1, rad = .2, 0);\r\nshape_1_per_frame30=\r\nshapecode_2_enabled=1\r\nshapecode_2_sides=8\r\nshapecode_2_additive=1\r\nshapecode_2_thickOutline=0\r\nshapecode_2_textured=0\r\nshapecode_2_num_inst=800\r\nshapecode_2_x=0.390\r\nshapecode_2_y=0.400\r\nshapecode_2_rad=0.01000\r\nshapecode_2_ang=0.00000\r\nshapecode_2_tex_ang=0.00000\r\nshapecode_2_tex_zoom=0.44790\r\nshapecode_2_r=0.000\r\nshapecode_2_g=0.300\r\nshapecode_2_b=1.000\r\nshapecode_2_a=0.500\r\nshapecode_2_r2=1.000\r\nshapecode_2_g2=1.000\r\nshapecode_2_b2=1.000\r\nshapecode_2_a2=0.000\r\nshapecode_2_border_r=0.000\r\nshapecode_2_border_g=0.000\r\nshapecode_2_border_b=0.000\r\nshapecode_2_border_a=0.000\r\nshape_2_per_frame1=self = instance*reg01;\r\nshape_2_per_frame2=age = gmegabuf(self+12);\r\nshape_2_per_frame3=max_age = reg02;\r\nshape_2_per_frame4=size = gmegabuf(self+13);\r\nshape_2_per_frame5=if (age > 0,\r\nshape_2_per_frame6=  x0 = gmegabuf(self)-reg07;\r\nshape_2_per_frame7=  y0 = gmegabuf(self+1)-reg08;\r\nshape_2_per_frame8=  z0 = gmegabuf(self+2)-reg09;\r\nshape_2_per_frame9=\r\nshape_2_per_frame10=\r\nshape_2_per_frame11=  x1 = x0*reg30 + y0*reg31 + z0*reg32;\r\nshape_2_per_frame12=  y1 = x0*reg33 + y0*reg34 + z0*reg35;\r\nshape_2_per_frame13=  z1 = x0*reg36 + y0*reg37 + z0*reg38;\r\nshape_2_per_frame14=\r\nshape_2_per_frame15=\r\nshape_2_per_frame16=  if (z1 > 0,\r\nshape_2_per_frame17=    fac = reg19;;\r\nshape_2_per_frame18=    x = .5 + x1/z1*fac*q31;\r\nshape_2_per_frame19=    y = .5 - y1/z1*fac*q32;\r\nshape_2_per_frame20=\r\nshape_2_per_frame21=    megabuf(instance) = megabuf(instance)*.5 + .5*(rand(100)/100);\r\nshape_2_per_frame22=  //#vorsicht mit time * instance - ersetzen !\r\nshape_2_per_frame23=\r\nshape_2_per_frame24=    bright = 1-age/max_age;\r\nshape_2_per_frame25=    bright =  min(1,max(0,4*bright- 2.5*megabuf(instance)));\r\nshape_2_per_frame26=    a = .7;\r\nshape_2_per_frame27=    //    k1 = 1-age/max_age;;\r\nshape_2_per_frame28=    rad = min(0.1,.0012*size/z1*bright); \r\nshape_2_per_frame29=//    k2 = pow(age/max_age,.2);\r\nshape_2_per_frame30=//    rad = min(0.1,.002*size/z1*4*k2*(1-k2)); \r\nshape_2_per_frame31=    \r\nshape_2_per_frame32=    k1 = 1;\r\nshape_2_per_frame33=    r=pow(gmegabuf(self+9),k1);\r\nshape_2_per_frame34=    g=pow(gmegabuf(self+10),k1);\r\nshape_2_per_frame35=    b=pow(gmegabuf(self+11),k1);\r\nshape_2_per_frame36=\r\nshape_2_per_frame37=\r\nshape_2_per_frame38=    tmp = .3;\r\nshape_2_per_frame39=    r2 = r*tmp; g2 = g*tmp; b2 = b*tmp; \r\nshape_2_per_frame40=    a2=0; \r\nshape_2_per_frame41=  ,gmegabuf(self+12) += q30; rad = 0; ); //#age prematurely ?);\r\nshape_2_per_frame42=\r\nshape_2_per_frame43=, a=0; rad =0;) \r\nshape_2_per_frame44=\r\nshapecode_3_enabled=1\r\nshapecode_3_sides=6\r\nshapecode_3_additive=1\r\nshapecode_3_thickOutline=0\r\nshapecode_3_textured=0\r\nshapecode_3_num_inst=300\r\nshapecode_3_x=0.650\r\nshapecode_3_y=0.800\r\nshapecode_3_rad=0.01000\r\nshapecode_3_ang=0.00000\r\nshapecode_3_tex_ang=0.00000\r\nshapecode_3_tex_zoom=0.33570\r\nshapecode_3_r=1.000\r\nshapecode_3_g=0.000\r\nshapecode_3_b=0.000\r\nshapecode_3_a=1.000\r\nshapecode_3_r2=0.000\r\nshapecode_3_g2=0.000\r\nshapecode_3_b2=0.000\r\nshapecode_3_a2=0.000\r\nshapecode_3_border_r=0.000\r\nshapecode_3_border_g=0.000\r\nshapecode_3_border_b=0.000\r\nshapecode_3_border_a=0.000\r\nshape_3_per_frame1=self = int(instance/num_inst*reg20)*reg01 + 100000; //#\r\nshape_3_per_frame2=\r\nshape_3_per_frame3=age = gmegabuf(self+12);\r\nshape_3_per_frame4=if (age > 0,\r\nshape_3_per_frame5=  max_age = reg22;\r\nshape_3_per_frame6=  x0 = gmegabuf(self)-reg07;\r\nshape_3_per_frame7=  y0 = gmegabuf(self+1)-reg08;\r\nshape_3_per_frame8=  z0 = gmegabuf(self+2)-reg09;\r\nshape_3_per_frame9=\r\nshape_3_per_frame10=\r\nshape_3_per_frame11=  x1 = x0*reg30 + y0*reg31 + z0*reg32;\r\nshape_3_per_frame12=  y1 = x0*reg33 + y0*reg34 + z0*reg35;\r\nshape_3_per_frame13=  z1 = x0*reg36 + y0*reg37 + z0*reg38;\r\nshape_3_per_frame14=\r\nshape_3_per_frame15=\r\nshape_3_per_frame16=  if (z1 > 0,\r\nshape_3_per_frame17=    rad = min(.1,.003/z1*gmegabuf(self+13)); //###\r\nshape_3_per_frame18=   \r\nshape_3_per_frame19=    r = gmegabuf(self+9);\r\nshape_3_per_frame20=    g = gmegabuf(self+10);\r\nshape_3_per_frame21=    b = gmegabuf(self+11);\r\nshape_3_per_frame22=    r2 = r/3; b2 = b/3; g2 = g/3;\r\nshape_3_per_frame23=    a = .14 * max(0,1-age/max_age);  a2 = 0;\r\nshape_3_per_frame24=    fac = reg19;;\r\nshape_3_per_frame25=    x = .5 + x1/z1*fac*q31;\r\nshape_3_per_frame26=    y = .5 - y1/z1*fac*q32;\r\nshape_3_per_frame27=  ,gmegabuf(self+12) += 4*q30; a= 0; rad=0); //#age prematurely ?);\r\nshape_3_per_frame28=\r\nshape_3_per_frame29=, a=0; rad=0;) ;\r\nshape_3_per_frame30=\r\nper_frame_init_1=//The camera tries to follow the head of the firework and look into its direction\r\nper_frame_init_2=//Camera speed and rotational speed is limited, camera lags behind\r\nper_frame_init_3=//Camera angle is forced back into horizontal position\r\nper_frame_init_4=\r\nper_frame_init_5=//-------------- BEGIN MAIN PARAMS ---------------\r\nper_frame_init_6=//SPEEDS\r\nper_frame_init_7=gSpeed = .6;   //global speed, affects all other speeds incl. particle lifetimes\r\nper_frame_init_8=hSpeed = .03;  //firework head speed\r\nper_frame_init_9=pSpeed = .07;   //speed of primary particles\r\nper_frame_init_10=tSpeed = hspeed*3.5;  //speed of tail particles\r\nper_frame_init_11=\r\nper_frame_init_12=//CAMERA\r\nper_frame_init_13=CamDist  = .02; //distance camera tries to stay behind firework \r\nper_frame_init_14=CamSpeed = .35;  //camera follower speed\r\nper_frame_init_15=CamLock = 8;    //how fast does camera angle lock on firework\r\nper_frame_init_16=HLock = .1;     //force camera angle back into horizontal view\r\nper_frame_init_17=\r\nper_frame_init_18=//OTHER PARAMS\r\nper_frame_init_19=sharp = 30;    //sharpness of bass/treb triggered head direction changes\r\nper_frame_init_20=g0 = .02;      //gravitation\r\nper_frame_init_21=cw = 50;       //air drag\r\nper_frame_init_22=\r\nper_frame_init_23=//---------- END MAIN PARAMS -----------------\r\nper_frame_init_24=\r\nper_frame_init_25=n = 0; loop (200000,gmegabuf(n) = 0; n+=1);\r\nper_frame_init_26=fac = .4; reg19 = fac;\r\nper_frame_init_27=\r\nper_frame_init_28=//SPARKS\r\nper_frame_init_29=obj_num = 800; reg00 = obj_num;\r\nper_frame_init_30=obj_size = 16; reg01 = obj_size;\r\nper_frame_init_31=max_age = 3.8; reg02 = max_age;\r\nper_frame_init_32=head_ptr = 0; \r\nper_frame_init_33=free = 0;\r\nper_frame_init_34=\r\nper_frame_init_35=//SPARKS2\r\nper_frame_init_36=num2 = 2048; reg20 = num2;\r\nper_frame_init_37=free2 = 0;\r\nper_frame_init_38=ptr2 = 0;\r\nper_frame_init_39=mage2 = 1.8; reg22 = mage2;\r\nper_frame_init_40=base2 = 100000;\r\nper_frame_init_41=\r\nper_frame_init_42=//TAIL\r\nper_frame_init_43=t_num = 800; reg10 =t_num;\r\nper_frame_init_44=t_age = 1; reg12 = t_age;\r\nper_frame_init_45=tbase = obj_num*obj_size; reg13 = tbase;\r\nper_frame_init_46=t_ptr = 0; \r\nper_frame_init_47=t_free = 0;\r\nper_frame_init_48=\r\nper_frame_init_49=\r\nper_frame_init_50=x0 = (rand(10)-5)*.03; y0 = (rand(10)-5)*.03; z0 = (rand(10)-5)*.03;;\r\nper_frame_init_51=xcam = 0; ycam = .0; zcam = -0;\r\nper_frame_init_52=//Obj Structure - Index\r\nper_frame_init_53=//0..2: x,y,z  3..5: vx,vy,vz  6..8: fx,fy,fz\r\nper_frame_init_54=//9..11: rgb     12: age         13: size;\r\nper_frame_init_55=\r\nper_frame_init_56=\r\nper_frame_init_57=//camera coordinate system\r\nper_frame_init_58=  c1 = cos(0); c2 = cos(0); c3 = cos(0); \r\nper_frame_init_59=  s1 = sin(0); s2 = sin(0); s3 = sin(0);\r\nper_frame_init_60=\r\nper_frame_init_61=  reg30 = c2*c1;            reg31 = c2*s1;            reg32 = -s2;\r\nper_frame_init_62=  reg33 = s3*s2*c1 - c3*s1; reg34 = s3*s2*s1 + c3*c1; reg35 = s3*c2;\r\nper_frame_init_63=  reg36 = c3*s2*c1 + s3*s1; reg37 = c3*s2*s1 - s3*c1; reg38 = c3*c2;\r\nper_frame_init_64=\r\nper_frame_init_65=\r\nper_frame_init_66=//head coordinate system\r\nper_frame_init_67=  reg50 = c2*c1;            reg51 = c2*s1;            reg52 = -s2;\r\nper_frame_init_68=  reg53 = s3*s2*c1 - c3*s1; reg54 = s3*s2*s1 + c3*c1; reg55 = s3*c2;\r\nper_frame_init_69=  reg56 = c3*s2*c1 + s3*s1; reg57 = c3*s2*s1 - s3*c1; reg58 = c3*c2;\r\nper_frame_init_70=\r\nper_frame_init_71=tmp = rand(12);\r\nper_frame_init_72=colr = .5+.5*sin(tmp); colg = .5 + .5*sin(tmp+2); colb = .5+.5*sin(tmp+4);\r\nper_frame_init_73=posx = rand(1000)/100; posz = rand(1000)/100;\r\nper_frame_init_74=\r\nper_frame_init_75=n1= rand(10)/20; n2 = rand(10)/20; n3 = rand(10)/20; n4 = rand(10)/20;\r\nper_frame_init_76=i1= rand(10)/20; i2 = rand(10)/20; i3 = rand(10)/20; i4 = rand(10)/20;\r\nper_frame_init_77=\r\nper_frame_init_78=index2 = int(rand(32));\r\nper_frame_init_79=//-----------------------------------------\r\nper_frame_1=chng=sin(time*.5);\r\nper_frame_2=cthr=.9999;\r\nper_frame_3=mq21=if(above(chng,cthr),rand(3),mq21);\r\nper_frame_4=mq22=if(above(chng,cthr),rand(3),mq22);\r\nper_frame_5=mq23=if(above(chng,cthr),rand(3),mq23);\r\nper_frame_6=mq24=if(above(chng,cthr),rand(2),mq24);\r\nper_frame_7=mq25=if(above(chng,cthr),rand(2),mq25);\r\nper_frame_8=mq26=if(above(chng,cthr),rand(2),mq26);\r\nper_frame_9=mq27=if(above(chng,cthr),rand(1),mq27);\r\nper_frame_10=mq28=if(above(chng,cthr),rand(1),mq28);\r\nper_frame_11=mq29=if(above(chng,cthr),rand(1)*.3,mq29);\r\nper_frame_12=mq31=if(above(chng,cthr),rand(1)*.3,mq31);\r\nper_frame_13=monitor=chng;\r\nper_frame_14=q21=mq21;q22=mq22;q23=mq23;q24=mq24;q25=mq25;q26=mq26;\r\nper_frame_15=q27=mq27;q28=mq28;q29=mq29;q31=mq31;\r\nper_frame_16=\r\nper_frame_17=monitor=mq1;\r\nper_frame_18=vol=bass+treb+mid;\r\nper_frame_19=atime=atime+vol;\r\nper_frame_20=q11=.4+sin(atime*.006        )*.4;\r\nper_frame_21=q12=.4+cos(atime*.00613828348)*.4;\r\nper_frame_22=q13=.4+sin(atime*.00598593455)*.4;\r\nper_frame_23=monitor=q13;\r\nper_frame_24=q4=sin(atime*.03);\r\nper_frame_25=q5=cos(atime*.030383824);\r\nper_frame_26=q6=tan(atime*.029384834);\r\nper_frame_27=\r\nper_frame_28=dt = gSpeed/fps; dt2 = dt ; \r\nper_frame_29=dec_s = 1-.015*30/fps; dec_m = pow(.95, 30/fps); dec_f = pow(.85, 30/fps);\r\nper_frame_30=vol_att = (bass + mid + treb)/3;\r\nper_frame_31=avg = avg*dec_s + (1-dec_s)*vol_att*(1.5-.2/cal);\r\nper_frame_32=\r\nper_frame_33=is_beat = above(vol_att, 1.25*peak) * above (time, t0+.3);\r\nper_frame_34=t0 = if(is_beat,time,t0);\r\nper_frame_35=peak = peak*dec_m  + (1-dec_m)*vol_att;\r\nper_frame_36=index = (index + is_beat) %16;\r\nper_frame_37=index2 = (index2 + is_beat*bnot(index))%16;\r\nper_frame_38=\r\nper_frame_39=//HEAD MOVEMENT x0,y0,z0 based on z-move in HEAD Coords\r\nper_frame_40=right = pow(bass_att-avg,1) * (bass_att > avg) *sharp*n1*sin(time*3)/cal; \r\nper_frame_41=up =  pow(treb_att-avg,1) * (treb_att > avg) * sharp*n2/cal; \r\nper_frame_42=\r\nper_frame_43=cal = max(.2,cal*dec_s + (1-dec_s)*sqrt(up*up+right*right)/4);\r\nper_frame_44=\r\nper_frame_45=if ((index%8==0)*is_beat,\r\nper_frame_46=  n1 = rand(100)/100-.5; n2 = rand(100)/100-.5; n3 = rand(100)/100-.5; n4 = pow(rand(100)/70,2)+.05;\r\nper_frame_47=  i1 = 1+int(rand(8)); i2 = 1+int(rand(8)); i3 = 1+int(rand(8)); ,0);\r\nper_frame_48=  \r\nper_frame_49=sp0 = (.5+sqrt(vol_att*4))*hSpeed;\r\nper_frame_50=dec = if(sp0 > speed,.5, dec_m); //checken\r\nper_frame_51=speed =  speed*dec + (1-dec)*sp0;;\r\nper_frame_52=\r\nper_frame_53=//HEAD COORD SYS\r\nper_frame_54=c1 = cos(up*dt); c2 = cos(right*dt); c3 = 1; \r\nper_frame_55=s1 = sin(up*dt); s2 = sin(right*dt); s3 = 0;\r\nper_frame_56=reg40 = c2*c3;            reg41 = c2*s3;            reg42 = -s2;\r\nper_frame_57=reg43 = s1*s2*c3 - c1*s3; reg44 = s1*s2*s3 + c1*c3; reg45 = s1*c2;\r\nper_frame_58=reg46 = c1*s2*c3 + s1*s3; reg47 = c1*s2*s3 - s1*c3; reg48 = c1*c2;\r\nper_frame_59=\r\nper_frame_60=q20 = reg40*reg50 + reg41*reg53 + reg42*reg56;\r\nper_frame_61=q21 = reg40*reg51 + reg41*reg54 + reg42*reg57;\r\nper_frame_62=q22 = reg40*reg52 + reg41*reg55 + reg42*reg58;\r\nper_frame_63=q23 = reg43*reg50 + reg44*reg53 + reg45*reg56;\r\nper_frame_64=q24 = reg43*reg51 + reg44*reg54 + reg45*reg57;\r\nper_frame_65=q25 = reg43*reg52 + reg44*reg55 + reg45*reg58;\r\nper_frame_66=q26 = reg46*reg50 + reg47*reg53 + reg48*reg56;\r\nper_frame_67=q27 = reg46*reg51 + reg47*reg54 + reg48*reg57;\r\nper_frame_68=q28 = reg46*reg52 + reg47*reg55 + reg48*reg58;\r\nper_frame_69=\r\nper_frame_70=reg50 = q20; reg51 = q21; reg52 = q22;\r\nper_frame_71=reg53 = q23; reg54 = q24; reg55 = q25;\r\nper_frame_72=reg56 = q26; reg57 = q27; reg58 = q28;\r\nper_frame_73=vx0 = reg56*speed;\r\nper_frame_74=vy0 = reg57*speed;\r\nper_frame_75=vz0 = reg58*speed;\r\nper_frame_76=x0 = x0 + vx0*dt ;          reg04 = x0; \r\nper_frame_77=y0 = max(-.5,min(0.5,y0 + vy0*dt)) ; reg05 = y0; \r\nper_frame_78=z0 = z0 + vz0*dt ;          reg06 = z0; \r\nper_frame_79=\r\nper_frame_80=style = n1 > 0;\r\nper_frame_81=circles = (index2>=12); \r\nper_frame_82=//SPARK QUEUE - insert new objects\r\nper_frame_83=if (style ==0, new = max(0,min(26*(mid>1.2),free)),0);\r\nper_frame_84=if (style ==1, new = max(0,min(250*vol_att*(vol_att*200 > 100+obj_num-free),free*.8)),0);\r\nper_frame_85=if (new < 16, new = 0, 0);\r\nper_frame_86=n = 0; m = new; \r\nper_frame_87=dec = if (new > 0,0.3,dec_f); \r\nper_frame_88=new_ = new_*dec + (1-dec)*new;\r\nper_frame_89=q29 = new_;\r\nper_frame_90=if (new > 0,\r\nper_frame_91=  if (index%5==0,\r\nper_frame_92=    csum = sqrt(pow(bass_att,2) + pow(mid_att,2) + pow(treb_att,2)) ;\r\nper_frame_93=    colr = pow(bass_att,1)/csum;\r\nper_frame_94=    colb = pow(mid_att,1)/csum;\r\nper_frame_95=    colg = pow(treb_att,1)/csum;,0);\r\nper_frame_96=  while (exec2 (\r\nper_frame_97=    self = (head_ptr%obj_num)*obj_size;\r\nper_frame_98=    if (gmegabuf(self+12) <= 0,\r\nper_frame_99=      // for rad.sym use theta = 1.5, phi = 0..6\r\nper_frame_100=      if (style==1,theta = 1.5 + 8*n3*sin(i2*6.28*n/new+time); phi = sin(i3*n/new*6.3)*6.3,\r\nper_frame_101=                         theta = rand(12); phi = rand(12));\r\nper_frame_102=      v0 = (1 + .1*(rand(100)/100-.5))*pSpeed * (1+4*n3*n2*cos(6.28*i1*n/new)); \r\nper_frame_103=      if (circles==0,\r\nper_frame_104=        vx = sin(theta)*cos(phi)*v0;\r\nper_frame_105=        vy = sin(theta)*sin(phi)*v0;\r\nper_frame_106=        vz = cos(theta)*v0;,0);\r\nper_frame_107=      vx1 = vx*reg50 + vy*reg53+ vz*reg56;\r\nper_frame_108=      vy1 = vx*reg51 + vy*reg54+ vz*reg57;\r\nper_frame_109=      vz1 = vx*reg52 + vy*reg55+ vz*reg58;\r\nper_frame_110=      vx = vx1; vy = vy1; vz = vz1;\r\nper_frame_111=      gmegabuf(self)   = x0;\r\nper_frame_112=      gmegabuf(self+1) = y0;\r\nper_frame_113=      gmegabuf(self+2) = z0;\r\nper_frame_114=      gmegabuf(self+3) = vx+vx0;\r\nper_frame_115=      gmegabuf(self+4) = vy+vy0;\r\nper_frame_116=      gmegabuf(self+5) = vz+vz0;\r\nper_frame_117=      gmegabuf(self+9) = colr;\r\nper_frame_118=      gmegabuf(self+10) = colg;\r\nper_frame_119=      gmegabuf(self+11) = colb;\r\nper_frame_120=      gmegabuf(self+12) = dt2;\r\nper_frame_121=      gmegabuf(self+13) = rand(100)/100+.5;//size\r\nper_frame_122=      gmegabuf(self+14) = min(free2,vol_att* (n%8==0)) * (gmegabuf(self+13)>1);\r\nper_frame_123=      n += 1; m -= 1;\r\nper_frame_124=   ,0;);\r\nper_frame_125=   head_ptr = (head_ptr+1)%obj_num;, m > 0))\r\nper_frame_126=,0);\r\nper_frame_127=\r\nper_frame_128=//SPARK QUEUE - calc movement\r\nper_frame_129=n = 0; free = 0;       \r\nper_frame_130=att0 = att0*dec_f + (1-dec_f)*-.05 * n1*n2*n3; \r\nper_frame_131=if (att0>0, att0*=.5,0);\r\nper_frame_132=att1 = -0.0005 * (index2%3==0);\r\nper_frame_133=\r\nper_frame_134=loop (obj_num,\r\nper_frame_135=  self = n*obj_size;\r\nper_frame_136=  age = gmegabuf(self+12);\r\nper_frame_137=  if (age > 0, \r\nper_frame_138=    if (age > max_age, age = 0, age += dt2 + 2*dt2*(style==0)*(index2%2));\r\nper_frame_139=      new = min (free2, gmegabuf(self+14));\r\nper_frame_140=      if (new > 0,\r\nper_frame_141=        while (exec2(  \r\nper_frame_142=          self2 = (ptr2%num2)*obj_size+base2;\r\nper_frame_143=          if (gmegabuf(self2+12) <= 0,\r\nper_frame_144=            gmegabuf(self2)   = gmegabuf(self);\r\nper_frame_145=            gmegabuf(self2+1) = gmegabuf(self+1);\r\nper_frame_146=            gmegabuf(self2+2) = gmegabuf(self+2);\r\nper_frame_147=            gmegabuf(self2+3) = gmegabuf(self+3)+pSpeed*(rand(100)/100-.5)*n4;\r\nper_frame_148=            gmegabuf(self2+4) = gmegabuf(self+4)+pSpeed*(rand(100)/100-.5)*n4;\r\nper_frame_149=            gmegabuf(self2+5) = gmegabuf(self+5)+pSpeed*(rand(100)/100-.5)*n4;\r\nper_frame_150=            gmegabuf(self2+9) = pow(gmegabuf(self+9),1.5);\r\nper_frame_151=            gmegabuf(self2+10) =pow(gmegabuf(self+10),1.5);\r\nper_frame_152=            gmegabuf(self2+11) =pow(gmegabuf(self+11),1.5);\r\nper_frame_153=            gmegabuf(self2+12) = dt2;\r\nper_frame_154=            gmegabuf(self2+13) = rand(100)/200+.5;//size\r\nper_frame_155=            new -=1; free2 -= 1;\r\nper_frame_156=          ,0;);\r\nper_frame_157=        ptr2 = (ptr2 + 1)%num2;, new > 0));\r\nper_frame_158=      ,gmegabuf(self+14) = 0);      //#nochmal pruefen !\r\nper_frame_159=      v2 = pow(gmegabuf(self+3),2)+pow(gmegabuf(self+4),2)+pow(gmegabuf(self+5),2);\r\nper_frame_160=      brake = max(0.5,1-dt*cw*v2);\r\nper_frame_161=      gmegabuf(self)   += gmegabuf(self+3)*dt;\r\nper_frame_162=      gmegabuf(self+1) += gmegabuf(self+4)*dt;\r\nper_frame_163=      gmegabuf(self+2) += gmegabuf(self+5)*dt;\r\nper_frame_164=      gmegabuf(self+3) *= brake;\r\nper_frame_165=      gmegabuf(self+4) *= brake;\r\nper_frame_166=      gmegabuf(self+5) *= brake;\r\nper_frame_167=    //head attraction\r\nper_frame_168=      dist = (pow(gmegabuf(self)-x0,2) + pow(gmegabuf(self+1)-y0,2) + pow(gmegabuf(self+2)-z0,2));\r\nper_frame_169=      ax = (att0*(gmegabuf(self)-x0)/dist);\r\nper_frame_170=      ay = (att0*(gmegabuf(self+1)-y0)/dist);\r\nper_frame_171=      az = (att0*(gmegabuf(self+2)-z0)/dist);\r\nper_frame_172=      gmegabuf(self+3) += ax*dt;\r\nper_frame_173=      gmegabuf(self+4) += ay*dt;\r\nper_frame_174=      gmegabuf(self+5) += az*dt;\r\nper_frame_175=\r\nper_frame_176=    //cam induced turbulence\r\nper_frame_177=      ax = atan(att1/(gmegabuf(self)-xcam));\r\nper_frame_178=      ay = atan(att1/(gmegabuf(self+1)-ycam));\r\nper_frame_179=      az = atan(att1/(gmegabuf(self+2)-zcam));\r\nper_frame_180=      gmegabuf(self+3) += ax*dt;\r\nper_frame_181=      gmegabuf(self+4) += ay*dt;\r\nper_frame_182=      gmegabuf(self+5) += az*dt;\r\nper_frame_183=\r\nper_frame_184=    //Gravitation\r\nper_frame_185=      gmegabuf(self+4) += g0*dt * gmegabuf(self+13); \r\nper_frame_186=  ,free += 1); //otherwise\r\nper_frame_187=  gmegabuf(self+12) = age;\r\nper_frame_188=  n += 1;);\r\nper_frame_189=\r\nper_frame_190=//2nd SPARK QUEUE - movement\r\nper_frame_191=n = 0; free2 = 0;\r\nper_frame_192=loop (num2,\r\nper_frame_193=  self = n*obj_size + base2;\r\nper_frame_194=  age = gmegabuf(self+12);\r\nper_frame_195=  if (age > 0, \r\nper_frame_196=    if (age > mage2, age = 0, age +=dt2);\r\nper_frame_197=    v2 = pow(gmegabuf(self+3),2)+pow(gmegabuf(self+4),2)+pow(gmegabuf(self+5),2);\r\nper_frame_198=    brake = max(0.1,1-200*dt*cw*v2);\r\nper_frame_199=    gmegabuf(self)   += gmegabuf(self+3)*dt;\r\nper_frame_200=    gmegabuf(self+1) += gmegabuf(self+4)*dt;\r\nper_frame_201=    gmegabuf(self+2) += gmegabuf(self+5)*dt;\r\nper_frame_202=    gmegabuf(self+3) *= brake;\r\nper_frame_203=    gmegabuf(self+4) *= brake;\r\nper_frame_204=    gmegabuf(self+5) *= brake;\r\nper_frame_205=    gmegabuf(self+4) += g0*dt; //Gravitation\r\nper_frame_206=  ,free2 += 1);\r\nper_frame_207=  gmegabuf(self+12) = age;\r\nper_frame_208=  n += 1;);\r\nper_frame_209=\r\nper_frame_210=//TAIL\r\nper_frame_211=new = int(t_free/8*vol_att); //# vol ?\r\nper_frame_212=new = min (new, t_free);\r\nper_frame_213=if (new > 0,\r\nper_frame_214=  while (exec2 (\r\nper_frame_215=    self = (t_ptr%t_num)*obj_size+tbase;\r\nper_frame_216=    if (gmegabuf(self+12) <= 0,\r\nper_frame_217=\r\nper_frame_218=      theta = .006*rand(12); phi = rand(12); ;\r\nper_frame_219=      v0 = (1 + .3*(rand(100)/100-.5))*-tSpeed; \r\nper_frame_220=      vx = sin(theta)*cos(phi)*v0;\r\nper_frame_221=      vy = sin(theta)*sin(phi)*v0;\r\nper_frame_222=      vz = cos(theta)*v0;\r\nper_frame_223=      vx1 = vx*reg50 + vy*reg53+ vz*reg56;\r\nper_frame_224=      vy1 = vx*reg51 + vy*reg54+ vz*reg57;\r\nper_frame_225=      vz1 = vx*reg52 + vy*reg55+ vz*reg58;\r\nper_frame_226=      vx = vx1; vy = vy1; vz = vz1; ran = -v0*dt*rand(100)/100;\r\nper_frame_227=      gmegabuf(self)   = x0 + ran*reg56;\r\nper_frame_228=      gmegabuf(self+1) = y0 + ran*reg57;\r\nper_frame_229=      gmegabuf(self+2) = z0 + ran*reg58;\r\nper_frame_230=      gmegabuf(self+3) = vx+vx0;\r\nper_frame_231=      gmegabuf(self+4) = vy+vy0;\r\nper_frame_232=      gmegabuf(self+5) = vz+vz0;\r\nper_frame_233=      gmegabuf(self+12) = dt2;\r\nper_frame_234=      gmegabuf(self+13) = .5 + rand(100)/150;//size\r\nper_frame_235=      new -= 1;\r\nper_frame_236=   ,0;);\r\nper_frame_237=  t_ptr = (t_ptr+1)%t_num;, new > 0))\r\nper_frame_238=,0);\r\nper_frame_239=reg14 = t_ptr;\r\nper_frame_240=\r\nper_frame_241=//TAIL QUEUE - calc movement\r\nper_frame_242=n = 0; t_free = 0;\r\nper_frame_243=loop (t_num,\r\nper_frame_244=  self = n*obj_size + tbase;\r\nper_frame_245=  age = gmegabuf(self+12);\r\nper_frame_246=  if (age > 0, \r\nper_frame_247=    if (age > t_age, age = 0, age +=dt2);\r\nper_frame_248=    v2 = pow(gmegabuf(self+3),2)+pow(gmegabuf(self+4),2)+pow(gmegabuf(self+5),2);\r\nper_frame_249=    brake = max(0.5,1-dt*cw*v2); \r\nper_frame_250=    gmegabuf(self)   += gmegabuf(self+3)*dt;\r\nper_frame_251=    gmegabuf(self+1) += gmegabuf(self+4)*dt;\r\nper_frame_252=    gmegabuf(self+2) += gmegabuf(self+5)*dt;\r\nper_frame_253=    gmegabuf(self+3) *= brake;\r\nper_frame_254=    gmegabuf(self+4) *= brake;\r\nper_frame_255=    gmegabuf(self+5) *= brake;\r\nper_frame_256=    gmegabuf(self+4) += g0*dt; //Gravitation\r\nper_frame_257=  ,t_free += 1); //otherwise\r\nper_frame_258=  gmegabuf(self+12) = age;\r\nper_frame_259=  n += 1;\r\nper_frame_260=);\r\nper_frame_261=\r\nper_frame_262=//SPARK and HEAD COORD for use in comp shader\r\nper_frame_263=\r\nper_frame_264=ranpt = if (rand(10)/7<vol_att,((head_ptr+obj_num-int(rand(obj_num/4)))%obj_num)*obj_size, ranpt);\r\nper_frame_265=point = ranpt;\r\nper_frame_266=x0_ = gmegabuf(point)-reg07; y0_ = gmegabuf(point+1)-reg08; z0_ = gmegabuf(point+2)-reg09;\r\nper_frame_267=x1 = x0_*reg30 + y0_*reg31 + z0_*reg32;\r\nper_frame_268=y1 = x0_*reg33 + y0_*reg34 + z0_*reg35;\r\nper_frame_269=z1 = x0_*reg36 + y0_*reg37 + z0_*reg38;\r\nper_frame_270=q11 = .5 + x1/z1*fac;\r\nper_frame_271=q12 = .5 + y1/z1*fac;\r\nper_frame_272=age = gmegabuf(point+12);\r\nper_frame_273=q13 = if (z1>0,1/z1,0) * (age > 0)*(1-age/max_age) * sqrt(treb)*.0008;\r\nper_frame_274=q13 = max(0,q13);\r\nper_frame_275=\r\nper_frame_276=x0_ = x0-reg07; y0_ = y0-reg08; z0_ = z0-reg09;\r\nper_frame_277=x1 = x0_*reg30 + y0_*reg31 + z0_*reg32;\r\nper_frame_278=y1 = x0_*reg33 + y0_*reg34 + z0_*reg35;\r\nper_frame_279=z1 = x0_*reg36 + y0_*reg37 + z0_*reg38;\r\nper_frame_280=q14 = .5 + x1/z1*fac;\r\nper_frame_281=q15 = .5 + y1/z1*fac;\r\nper_frame_282=q16 = if (z1>0, 1/z1,0) * q29/4+20 + 20*vol_att;\r\nper_frame_283=q16 = max(0,q16/4);\r\nper_frame_284=\r\nper_frame_285=\r\nper_frame_286=//FOLLOW WITH CAMERA\r\nper_frame_287=dxcam = (x0-xcam)*dt*CamSpeed; dycam = (y0-ycam-.0)*dt*CamSpeed; dzcam = (z0-zcam-CamDist)*dt*CamSpeed; \r\nper_frame_288=xcam = xcam +dxcam; ycam = ycam +dycam; zcam = zcam +dzcam; \r\nper_frame_289=reg07 = xcam; reg08 = ycam; reg09 = zcam;\r\nper_frame_290=\r\nper_frame_291=//ROTATE VIEPOINT\r\nper_frame_292=x1 = (x0-XCam)*reg30 + (y0-yCam) *reg31 + (z0-zCam)*reg32;\r\nper_frame_293=y1 = (x0-XCam)*reg33 + (y0-YCam) *reg34 + (z0-zCam)*reg35;\r\nper_frame_294=dist = sqrt(pow(x0-xcam,2) + pow(y0-ycam,2) + pow(z0-zcam,2));\r\nper_frame_295=k1 = dt/max(dist,.04)*CamLock;\r\nper_frame_296=v1 =  -k1*(y1); v2 = k1*(x1); v3 = -reg31*k1*HLock;\r\nper_frame_297=\r\nper_frame_298=c1 = cos(v1); c2 = cos(v2); c3 = cos(v3); \r\nper_frame_299=s1 = sin(v1); s2 = sin(v2); s3 = sin(v3);\r\nper_frame_300=reg40 = c2*c3; reg41 = c2*s3; reg42 = -s2;\r\nper_frame_301=reg43 = s1*s2*c3 - c1*s3; reg44 = s1*s2*s3 + c1*c3; reg45 = s1*c2;\r\nper_frame_302=reg46 = c1*s2*c3 + s1*s3; reg47 = c1*s2*s3 - s1*c3; reg48 = c1*c2;\r\nper_frame_303=\r\nper_frame_304=q20 = reg40*reg30 + reg41*reg33 + reg42*reg36;\r\nper_frame_305=q21 = reg40*reg31 + reg41*reg34 + reg42*reg37;\r\nper_frame_306=q22 = reg40*reg32 + reg41*reg35 + reg42*reg38;\r\nper_frame_307=q23 = reg43*reg30 + reg44*reg33 + reg45*reg36;\r\nper_frame_308=q24 = reg43*reg31 + reg44*reg34 + reg45*reg37;\r\nper_frame_309=q25 = reg43*reg32 + reg44*reg35 + reg45*reg38;\r\nper_frame_310=q26 = reg46*reg30 + reg47*reg33 + reg48*reg36;\r\nper_frame_311=q27 = reg46*reg31 + reg47*reg34 + reg48*reg37;\r\nper_frame_312=q28 = reg46*reg32 + reg47*reg35 + reg48*reg38;\r\nper_frame_313=reg30 =q20; reg31 =q21; reg32 =q22; \r\nper_frame_314=reg33 =q23; reg34 =q24; reg35 =q25;\r\nper_frame_315=reg36 =q26; reg37 =q27; reg38 =q28;\r\nper_frame_316=\r\nper_frame_317=//Fake altitude\r\nper_frame_318=q10 = (1.3-ycam);\r\nper_frame_319=\r\nper_frame_320=//TEXTURE GND MOVEMENT\r\nper_frame_321=posx += dxcam; posz += dzcam;\r\nper_frame_322=q18 = posz*2; \r\nper_frame_323=q19 = posx*2;\r\nper_frame_324=\r\nper_frame_325=//CLOUDS MOVEMENT\r\nper_frame_326=crot = crot + v3;\r\nper_frame_327=cfwd = cfwd + (dxcam*reg36 + dycam*reg37 + dzcam*reg38);\r\nper_frame_328=\r\nper_frame_329=q1 = cos(crot);q2 = sin(crot);\r\nper_frame_330=cmovx += -v1 * q1 + v2 * q2;\r\nper_frame_331=cmovy +=  v1 * q2 + v2 * q1;\r\nper_frame_332=q5 = cmovx*.1;\r\nper_frame_333=q6 = cmovy*.1;\r\nper_frame_334=q7 = cfwd*8;\r\nper_frame_335=q8 = v3;\r\nper_frame_336=q9 = (dxcam*reg36 + dycam*reg37 + dzcam*reg38);\r\nper_frame_337=\r\nper_frame_338=q30 = dt2;\r\nper_frame_339=q31 = aspectx;\r\nper_frame_340=q32 = aspecty;\r\nper_frame_341=\r\nper_frame_342=q17 = int(colr*10) + int(colg*10)*10 + int(colb*10)*100;\r\nper_frame_343=gg = .5;\r\nper_frame_344=dx = -v2*gg; dy = v1*gg;\r\nper_frame_345=rot = q8;\r\nper_frame_346=zoom = 1+(dxcam*reg36 + dycam*reg37 + dzcam*reg38);\r\nper_frame_347=\r\nper_frame_348=q3 = free;\r\nper_frame_349=monitor = num2;\r\nwarp_1=`#define sat saturate\r\nwarp_2=`\r\nwarp_3=`shader_body\r\nwarp_4=`{\r\nwarp_5=`\r\nwarp_6=`uv = 0.5 + (1.0 - abs( frac( uv * 0.5 ) * 2 - 1.0 )-.5); // Eo.S. mirror code\r\nwarp_7=`\r\nwarp_8=`float bri = lum(GetBlur2(uv_orig));\r\nwarp_9=`ret = lerp(GetPixel(uv),GetBlur1(uv),.3) - .006;\r\nwarp_10=`ret *= saturate(1-bri)* .9;\r\nwarp_11=`\r\nwarp_12=`ret.z=.1-ret.y;\r\nwarp_13=`ret.y=.1-ret.x;\r\nwarp_14=`ret.x=.1-ret.z;\r\nwarp_15=`//ret = 0;\r\nwarp_16=`}\r\nwarp_17=`\r\ncomp_1=`#define sat saturate\r\ncomp_2=`#define sampler_test sampler_moss1\r\ncomp_3=`sampler sampler_pw_noise_lq;\r\ncomp_4=`sampler sampler_test;\r\ncomp_5=`float inten, z, tmp, lprof, gnd, ncloud;\r\ncomp_6=`float2 dz, uv1,uv2, uv3, uv4;\r\ncomp_7=`float3 back, back2, sky, ret1, ret2, rs, rs1, cloud, fcol, forest;\r\ncomp_8=`static const float3x3 RotMat = float3x3(q20,q21,q22,q23,q24,q25,q26,q27,q28);\r\ncomp_9=`static const float3 t = float3(q20,q23,q26);\r\ncomp_10=`static const float3 s = float3(q22,q25,q28);\r\ncomp_11=`static const float3 ts = cross(t,s);\r\ncomp_12=`static const float2 movxz = float2(q18,q19);\r\ncomp_13=`static const float3 col = pow(float3((q17%10.0)/10,((q17/10.0)%10)/10.0,int(q17/100.0)/10.0),.8);\r\ncomp_14=`static const float hlim = 11;\r\ncomp_15=`float3 screen;\r\ncomp_16=`\r\ncomp_17=`float3 lavcol (float t) { return pow(.5,2*t*slow_roam_cos);}\r\ncomp_18=`\r\ncomp_19=`float aTan2(float y, float x) {float angle;\t float abs_y = abs(y);\r\ncomp_20=`if (x >= 0) {float r = (x - abs_y) / (x + abs_y); angle = 1-r;} \r\ncomp_21=`else {float r = (x + abs_y) / (abs_y - x); angle = 3-r; }\t\r\ncomp_22=`angle = angle * .25;\r\ncomp_23=`return y < 0 ? -angle : angle;}\r\ncomp_24=`\r\ncomp_25=`float3 project  (float dist) {float z; \r\ncomp_26=`  z = dist/mul(ts,screen); z = clamp(z,-hlim,hlim);\r\ncomp_27=`  return float3((mul(float2x3(t,s),cross(ts,screen))*z*.6+movxz),-z);}\r\ncomp_28=`\r\ncomp_29=`float noise4 (float2 uvi) { float n1,n2,zv; zv = 0.008*time;\r\ncomp_30=`  n1 = lum(tex2D(sampler_noise_hq, (uvi)));\r\ncomp_31=`  n2 = lum(tex2D(sampler_noise_hq, (uvi*2+zv)));\r\ncomp_32=`  return n1 + n2/2 ;}\r\ncomp_33=`\r\ncomp_34=`shader_body {\r\ncomp_35=`uv1 = (uv-.5)*aspect.xy+.5;\r\ncomp_36=`screen = float3 ((uv-float2(.5,.5+.0*pow((uv.x-.5),2)))*aspect.xy,.6);\r\ncomp_37=`\r\ncomp_38=`//CLOUDS\r\ncomp_39=`uv2 = mul(uv1*float2(1,1),float2x2(q1,q2,-q2,q1));\r\ncomp_40=`float anz = 3.0; float t_rel = q7;\r\ncomp_41=`cloud = 0;\r\ncomp_42=`for (int n=1;n<=anz;n++) {\r\ncomp_43=`    z = 1-frac(1.0*n/anz-1.0*frac(-t_rel/anz)); \r\ncomp_44=`    inten =  (1-z)*z*2;\r\ncomp_45=`    uv2 = z*uv2*.2 + float2(q6,q5); //?\r\ncomp_46=`    tmp = sat(lum(tex2D (sampler_noise_hq,uv2 +.01*noise4(uv2*4))-.6));\r\ncomp_47=`    cloud = cloud + tmp*inten;}\r\ncomp_48=`ncloud = 1-cloud;\r\ncomp_49=`fcol = tex2D(sampler_test,uv2*.2);\r\ncomp_50=`cloud *= (.3+fcol);\r\ncomp_51=`\r\ncomp_52=`//SKY AND GROUND\r\ncomp_53=`rs = project (q10); float3 rs0 = rs;\r\ncomp_54=`float3 noise = tex2D (sampler_noise_hq,rs.xy*.1);\r\ncomp_55=`gnd = .4*(noise.z-.5)/rs.z;\r\ncomp_56=`\r\ncomp_57=`forest = 0;\r\ncomp_58=`for (int m = 1; m <= 2; m++)\r\ncomp_59=`{ rs = project(q10+gnd);\r\ncomp_60=`  rs.xy += .01*(tex2D (sampler_noise_hq,float2(rs.xy/2+time*.01))-.5);; //wind\r\ncomp_61=`  rs1 = rs;\r\ncomp_62=`  rs1.xy = 0.5 + (1.0 - abs( frac( rs.xy * 0.5 ) * 2 - 1.0 )-.5); // Eo.S. mirror code \r\ncomp_63=`  back = tex2D (sampler_test,rs1.xy);;\r\ncomp_64=`  lprof =  back.g;\r\ncomp_65=`  tmp =  1-(saturate(1.8*lprof-.3*(2-m))); \r\ncomp_66=`  forest += back * saturate(lprof*1)*.1 ;\r\ncomp_67=`  gnd += tmp/pow(rs.z,2)*.3; \r\ncomp_68=`}\r\ncomp_69=`forest *= 1-noise.x+lprof;\r\ncomp_70=`forest += (.2/length(abs(noise.xy-.2-forest.g/2)))/rs.z * (.5+slow_roam_sin)/4 ;\r\ncomp_71=`back = forest/pow(rs.z,1) * (rs.z>0) * (rs.z < hlim);\r\ncomp_72=`\r\ncomp_73=`float k1 = saturate(1-10/abs(pow(rs.z,1.8)));\r\ncomp_74=`back = lerp(back,.08*lavcol(k1), k1) ;;\r\ncomp_75=`\r\ncomp_76=`ret1 = lerp(GetPixel(uv),2*GetBlur1(uv),.0) *3 * ncloud;\r\ncomp_77=`ret2 = GetBlur2(uv)*2.0 + GetBlur3(uv)*4.0;\r\ncomp_78=`ret1 = lerp (ret1, ret2, 2*cloud);;\r\ncomp_79=`ret = back*ncloud + ret1 + cloud/3;\r\ncomp_80=`\r\ncomp_81=`\r\ncomp_82=`uv2 = uv1-float2(q11,q12);\r\ncomp_83=`float flash = q13/(length(uv2));\r\ncomp_84=`flash *= flash/(abs(frac(q12*4+int(1+treb_att)*aTan2(uv2.x,uv2.y))-.5)+.18);\r\ncomp_85=`\r\ncomp_86=`uv2 = uv1-float2(q14,q15);\r\ncomp_87=`float head = pow(.0001/(length(uv2)),.8)*q16;\r\ncomp_88=`ret += pow(head+flash,ncloud)*col;\r\ncomp_89=`\r\ncomp_90=`ret += GetBlur3((uv-.5)/2+.5)/pow(rs.z,2)*(rs.z>0)*(rs.z<hlim)*lprof*2;\r\ncomp_91=`\r\ncomp_92=`}\r\ncomp_93=`\r\ncomp_94=`//-------------------------------------------\r\ncomp_95=`//Written by martin\r\ncomp_96=`\r\n"
}
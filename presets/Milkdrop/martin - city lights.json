{
  "name": "martin - city lights",
  "description": "martin - city lights",
  "milkdrop_raw": "MILKDROP_PRESET_VERSION=201\r\nPSVERSION=3\r\nPSVERSION_WARP=3\r\nPSVERSION_COMP=3\r\n[preset00]\r\nfRating=5.000000\r\nfGammaAdj=1.980\r\nfDecay=0.500\r\nfVideoEchoZoom=1.000\r\nfVideoEchoAlpha=0.500\r\nnVideoEchoOrientation=3\r\nnWaveMode=7\r\nbAdditiveWaves=1\r\nbWaveDots=0\r\nbWaveThick=1\r\nbModWaveAlphaByVolume=0\r\nbMaximizeWaveColor=0\r\nbTexWrap=1\r\nbDarkenCenter=0\r\nbRedBlueStereo=0\r\nbBrighten=0\r\nbDarken=1\r\nbSolarize=0\r\nbInvert=0\r\nfWaveAlpha=1.059\r\nfWaveScale=8.991\r\nfWaveSmoothing=0.000\r\nfWaveParam=0.000\r\nfModWaveAlphaStart=0.000\r\nfModWaveAlphaEnd=0.000\r\nfWarpAnimSpeed=1.459\r\nfWarpScale=2.007\r\nfZoomExponent=1.00000\r\nfShader=0.000\r\nzoom=0.99990\r\nrot=0.00000\r\ncx=0.500\r\ncy=0.500\r\ndx=0.00000\r\ndy=0.00000\r\nwarp=0.01000\r\nsx=0.99990\r\nsy=1.00000\r\nwave_r=0.000\r\nwave_g=0.000\r\nwave_b=0.000\r\nwave_x=0.500\r\nwave_y=0.500\r\nob_size=0.000\r\nob_r=0.000\r\nob_g=0.000\r\nob_b=0.000\r\nob_a=1.000\r\nib_size=0.260\r\nib_r=0.250\r\nib_g=0.250\r\nib_b=0.250\r\nib_a=0.000\r\nnMotionVectorsX=64.000\r\nnMotionVectorsY=48.000\r\nmv_dx=0.000\r\nmv_dy=0.000\r\nmv_l=1.850\r\nmv_r=0.500\r\nmv_g=0.500\r\nmv_b=0.500\r\nmv_a=0.000\r\nb1n=0.000\r\nb2n=0.000\r\nb3n=0.000\r\nb1x=0.990\r\nb2x=1.000\r\nb3x=1.000\r\nb1ed=0.000\r\nwavecode_0_enabled=1\r\nwavecode_0_samples=200\r\nwavecode_0_sep=0\r\nwavecode_0_bSpectrum=0\r\nwavecode_0_bUseDots=1\r\nwavecode_0_bDrawThick=0\r\nwavecode_0_bAdditive=1\r\nwavecode_0_scaling=0.89152\r\nwavecode_0_smoothing=0.82000\r\nwavecode_0_r=0.000\r\nwavecode_0_g=0.000\r\nwavecode_0_b=1.000\r\nwavecode_0_a=0.600\r\nwave_0_init1=t1 = 1 + (rand(101)*.01 - rand(101)*.01)*.3;\r\nwave_0_init2=t2 = 1 + (rand(101)*.01 - rand(101)*.01)*.3;\r\nwave_0_init3=t3 = 1 + (rand(101)*.01 - rand(101)*.01)*.3;\r\nwave_0_init4=t4 = 1 + (rand(101)*.01 - rand(101)*.01)*.3;\r\nwave_0_init5=t5 = 1 + (rand(101)*.01 - rand(101)*.01)*.3;\r\nwave_0_init6=t6 = 1 + (rand(101)*.01 - rand(101)*.01)*.3;\r\nwave_0_init7=t7 = 1 + (rand(101)*.01 - rand(101)*.01)*.3;\r\nwave_0_init8=t8 = 1 + (rand(101)*.01 - rand(101)*.01)*.3;\r\nwave_0_init9=\r\nwave_0_per_frame1=t1 = 0;\r\nwave_0_per_point1=row = (t1/2)%2;\r\nwave_0_per_point2=wid = (t1+2)%4;\r\nwave_0_per_point3=dx = 0.014* (row -0.5) + 0.0025* (wid-1.5);\r\nwave_0_per_point4=x = 0.5 + dx;\r\nwave_0_per_point5=\r\nwave_0_per_point6=y = int(t1/4)/50;\r\nwave_0_per_point7=y = y - int(y);\r\nwave_0_per_point8=\r\nwave_0_per_point9=t1 += 1;\r\nwavecode_1_enabled=0\r\nwavecode_1_samples=512\r\nwavecode_1_sep=0\r\nwavecode_1_bSpectrum=0\r\nwavecode_1_bUseDots=0\r\nwavecode_1_bDrawThick=0\r\nwavecode_1_bAdditive=0\r\nwavecode_1_scaling=0.89152\r\nwavecode_1_smoothing=1.00000\r\nwavecode_1_r=1.000\r\nwavecode_1_g=0.600\r\nwavecode_1_b=0.000\r\nwavecode_1_a=1.000\r\nwave_1_init1=t1 = 1 + (rand(101)*.01 - rand(101)*.01)*.3;\r\nwave_1_init2=t2 = 1 + (rand(101)*.01 - rand(101)*.01)*.3;\r\nwave_1_init3=t3 = 1 + (rand(101)*.01 - rand(101)*.01)*.3;\r\nwave_1_init4=t4 = 1 + (rand(101)*.01 - rand(101)*.01)*.3;\r\nwave_1_init5=t5 = 1 + (rand(101)*.01 - rand(101)*.01)*.3;\r\nwave_1_init6=t6 = 1 + (rand(101)*.01 - rand(101)*.01)*.3;\r\nwave_1_init7=t7 = 1 + (rand(101)*.01 - rand(101)*.01)*.3;\r\nwave_1_init8=t8 = 1 + (rand(101)*.01 - rand(101)*.01)*.3;\r\nwave_1_init9=\r\nwave_1_per_frame1=trel = q1-.0;\r\nwave_1_per_frame2=t1 = int(trel)/2;\r\nwave_1_per_frame3=t2 = trel - int(trel);\r\nwavecode_2_enabled=0\r\nwavecode_2_samples=512\r\nwavecode_2_sep=0\r\nwavecode_2_bSpectrum=0\r\nwavecode_2_bUseDots=0\r\nwavecode_2_bDrawThick=0\r\nwavecode_2_bAdditive=0\r\nwavecode_2_scaling=0.01348\r\nwavecode_2_smoothing=0.00000\r\nwavecode_2_r=1.000\r\nwavecode_2_g=0.600\r\nwavecode_2_b=0.000\r\nwavecode_2_a=0.310\r\nwave_2_init1=t1 = 1 + (rand(101)*.01 - rand(101)*.01)*.3;\r\nwave_2_init2=t2 = 1 + (rand(101)*.01 - rand(101)*.01)*.3;\r\nwave_2_init3=t3 = 1 + (rand(101)*.01 - rand(101)*.01)*.3;\r\nwave_2_init4=t4 = 1 + (rand(101)*.01 - rand(101)*.01)*.3;\r\nwave_2_init5=t5 = 1 + (rand(101)*.01 - rand(101)*.01)*.3;\r\nwave_2_init6=t6 = 1 + (rand(101)*.01 - rand(101)*.01)*.3;\r\nwave_2_init7=t7 = 1 + (rand(101)*.01 - rand(101)*.01)*.3;\r\nwave_2_init8=t8 = 1 + (rand(101)*.01 - rand(101)*.01)*.3;\r\nwave_2_init9=\r\nwave_2_per_frame1=trel = q1-.33;\r\nwave_2_per_frame2=t1 = int(trel)/3;\r\nwave_2_per_frame3=t2 = trel - int(trel);\r\nwave_2_per_frame4=\r\nwave_2_per_frame5=\r\nwave_2_per_frame6=\r\nwavecode_3_enabled=0\r\nwavecode_3_samples=512\r\nwavecode_3_sep=0\r\nwavecode_3_bSpectrum=1\r\nwavecode_3_bUseDots=0\r\nwavecode_3_bDrawThick=0\r\nwavecode_3_bAdditive=0\r\nwavecode_3_scaling=1.00000\r\nwavecode_3_smoothing=0.50000\r\nwavecode_3_r=1.000\r\nwavecode_3_g=0.600\r\nwavecode_3_b=0.000\r\nwavecode_3_a=1.000\r\nwave_3_per_frame1=trel = q1-.66;\r\nwave_3_per_frame2=t1 = int(trel);\r\nwave_3_per_frame3=t2 = trel - int(trel);\r\nshapecode_0_enabled=1\r\nshapecode_0_sides=12\r\nshapecode_0_additive=0\r\nshapecode_0_thickOutline=0\r\nshapecode_0_textured=0\r\nshapecode_0_num_inst=44\r\nshapecode_0_x=0.200\r\nshapecode_0_y=0.900\r\nshapecode_0_rad=0.01000\r\nshapecode_0_ang=0.00000\r\nshapecode_0_tex_ang=0.00000\r\nshapecode_0_tex_zoom=0.85169\r\nshapecode_0_r=0.000\r\nshapecode_0_g=1.000\r\nshapecode_0_b=1.000\r\nshapecode_0_a=1.000\r\nshapecode_0_r2=0.000\r\nshapecode_0_g2=0.000\r\nshapecode_0_b2=0.000\r\nshapecode_0_a2=1.000\r\nshapecode_0_border_r=0.000\r\nshapecode_0_border_g=0.000\r\nshapecode_0_border_b=0.000\r\nshapecode_0_border_a=0.200\r\nshape_0_per_frame1=sides = 4;\r\nshape_0_per_frame2=nx = instance%6;\r\nshape_0_per_frame3=ny = int (instance/6);\r\nshape_0_per_frame4=\r\nshape_0_per_frame5=if (instance <= 35,\r\nshape_0_per_frame6=  x = 0.5 + (nx-3)/4; \r\nshape_0_per_frame7=  y = 0.5 + (ny-3)/4; \r\nshape_0_per_frame8=  rad = 0.04;\r\nshape_0_per_frame9=  r=0; r2 = 0;\r\nshape_0_per_frame10=\r\nshape_0_per_frame11=,\r\nshape_0_per_frame12=  if (instance < 38,\r\nshape_0_per_frame13=    x = 0.5 - 0.47/q32 * (instance%2-0.5);\r\nshape_0_per_frame14=    y = 0.5;      \r\nshape_0_per_frame15=    rad = 0.06;\r\nshape_0_per_frame16=     r=0; r2 = 0.6;\r\nshape_0_per_frame17=,\r\nshape_0_per_frame18=     x = 0.5 - 0.0/q32 * (instance%3-1);\r\nshape_0_per_frame19=     y = 0.5 - 0.47*(int (instance/3)%2-0.5);      \r\nshape_0_per_frame20=     rad = 0.06;\r\nshape_0_per_frame21=     r=0.5; r2 = 0.3; ang = 0; sides = 4;\r\nshape_0_per_frame22=);\r\nshape_0_per_frame23=);\r\nshape_0_per_frame24=\r\nshape_0_per_frame25=g = 0; g2 = 0;\r\nshape_0_per_frame26=b = nx%2; b2 = !q3 * (instance%4==1);\r\nshape_0_per_frame27=border_b = 1-b;\r\nshape_0_per_frame28=a = 1;\r\nshape_0_per_frame29=a2 = a;\r\nshape_0_per_frame30=\r\nshape_0_per_frame31=\r\nshapecode_1_enabled=1\r\nshapecode_1_sides=4\r\nshapecode_1_additive=1\r\nshapecode_1_thickOutline=1\r\nshapecode_1_textured=0\r\nshapecode_1_num_inst=55\r\nshapecode_1_x=0.600\r\nshapecode_1_y=0.500\r\nshapecode_1_rad=0.03300\r\nshapecode_1_ang=0.00000\r\nshapecode_1_tex_ang=0.00000\r\nshapecode_1_tex_zoom=6.16617\r\nshapecode_1_r=0.400\r\nshapecode_1_g=1.000\r\nshapecode_1_b=0.700\r\nshapecode_1_a=0.900\r\nshapecode_1_r2=0.000\r\nshapecode_1_g2=0.000\r\nshapecode_1_b2=0.000\r\nshapecode_1_a2=1.000\r\nshapecode_1_border_r=0.500\r\nshapecode_1_border_g=0.500\r\nshapecode_1_border_b=0.500\r\nshapecode_1_border_a=0.000\r\nshape_1_per_frame1=\r\nshape_1_per_frame2=\r\nshape_1_per_frame3=x = 0.5 + 0.4*sin(instance*reg01);\r\nshape_1_per_frame4=y = 0.5 + 0.4*sin(instance*reg02);\r\nshape_1_per_frame5=\r\nshape_1_per_frame6=rad = 0.14 + 0.06*sin(instance*324.253);\r\nshape_1_per_frame7=\r\nshape_1_per_frame8=n = instance * 8 + 10000;\r\nshape_1_per_frame9=//x = gmegabuf(n);\r\nshape_1_per_frame10=//y = 1-gmegabuf(n+1);\r\nshape_1_per_frame11=//rad = gmegabuf(n+2);\r\nshape_1_per_frame12=//sides = gmegabuf(n+3);\r\nshape_1_per_frame13=\r\nshape_1_per_frame14=\r\nshape_1_per_frame15=//if (instance%8==0, sides = 20, sides = 4);\r\nshape_1_per_frame16=\r\nshape_1_per_frame17=\r\nshape_1_per_frame18=g=0; g2 = 0 ;\r\nshape_1_per_frame19=r =  (instance%2); r2 = 1;\r\nshape_1_per_frame20=b = 0; b2 = 0.5 * (instance%3>=1);\r\nshape_1_per_frame21=a = 1;\r\nshape_1_per_frame22=//rad *= min(1,x*y*4);\r\nshape_1_per_frame23=a2 = a*0.3;\r\nshape_1_per_frame24=\r\nshape_1_per_frame25=\r\nshapecode_2_enabled=0\r\nshapecode_2_sides=4\r\nshapecode_2_additive=0\r\nshapecode_2_thickOutline=0\r\nshapecode_2_textured=0\r\nshapecode_2_num_inst=8\r\nshapecode_2_x=0.873\r\nshapecode_2_y=0.130\r\nshapecode_2_rad=0.29166\r\nshapecode_2_ang=0.00000\r\nshapecode_2_tex_ang=2.51327\r\nshapecode_2_tex_zoom=0.74415\r\nshapecode_2_r=0.000\r\nshapecode_2_g=0.000\r\nshapecode_2_b=0.000\r\nshapecode_2_a=1.000\r\nshapecode_2_r2=0.000\r\nshapecode_2_g2=0.000\r\nshapecode_2_b2=0.000\r\nshapecode_2_a2=0.400\r\nshapecode_2_border_r=0.800\r\nshapecode_2_border_g=0.500\r\nshapecode_2_border_b=0.000\r\nshapecode_2_border_a=0.000\r\nshape_2_per_frame1=x = 0.7 + instance*0.02;;\r\nshape_2_per_frame2=y = 0.75;\r\nshape_2_per_frame3=\r\nshape_2_per_frame4=\r\nshape_2_per_frame5=//r = 0.4; r2 = 0.4;\r\nshape_2_per_frame6=b = 0.3; b2 = b;\r\nshape_2_per_frame7=rad = 0.04;\r\nshapecode_3_enabled=0\r\nshapecode_3_sides=24\r\nshapecode_3_additive=1\r\nshapecode_3_thickOutline=0\r\nshapecode_3_textured=1\r\nshapecode_3_num_inst=1\r\nshapecode_3_x=0.550\r\nshapecode_3_y=0.350\r\nshapecode_3_rad=0.09863\r\nshapecode_3_ang=0.00000\r\nshapecode_3_tex_ang=0.00000\r\nshapecode_3_tex_zoom=1.31212\r\nshapecode_3_r=0.000\r\nshapecode_3_g=1.000\r\nshapecode_3_b=0.000\r\nshapecode_3_a=1.000\r\nshapecode_3_r2=0.000\r\nshapecode_3_g2=0.600\r\nshapecode_3_b2=0.000\r\nshapecode_3_a2=0.000\r\nshapecode_3_border_r=0.500\r\nshapecode_3_border_g=0.500\r\nshapecode_3_border_b=0.500\r\nshapecode_3_border_a=0.000\r\nper_frame_init_1=n = 0; loop (10000, gmegabuf(n)=0; n +=1; );\r\nper_frame_init_2=\r\nper_frame_init_3=reg01 = int(rand(100)+5);\r\nper_frame_init_4=reg02 = int(rand(100)+10);\r\nper_frame_init_5=\r\nper_frame_init_6=fwx = rand(10);\r\nper_frame_init_7=fwy = rand(10);\r\nper_frame_init_8=zang = rand(6);\r\nper_frame_init_9=\r\nper_frame_init_10=ran1 = -0.5;\r\nper_frame_init_11=trad1 = rand(6);\r\nper_frame_init_12=trad2 = rand(6);\r\nper_frame_1=dt = 1/fps;\r\nper_frame_2=dec_m = 1 - 6*dt; dec_s = 1 - 2*dt; dec_xs = 1-dt;\r\nper_frame_3=vol = bass+mid+treb; \r\nper_frame_4=vol_ = vol_*dec_m + (1-dec_m)*vol;\r\nper_frame_5=is_beat = above(vol, .4+vol_+peak) * above (time, t0+.2);\r\nper_frame_6=t0 = is_beat*time + (1-is_beat)*t0;\r\nper_frame_7=peak = is_beat * vol + (1-is_beat)*peak*dec_m;\r\nper_frame_8=index = (index + is_beat) %32;\r\nper_frame_9=index2 = (index2 + is_beat*bnot(index))%8;\r\nper_frame_10=index3 = (index3 + is_beat* if(bnot(rand(8)%2),-1,1)*bnot(index%16))%6;\r\nper_frame_11=\r\nper_frame_12=num_res = 200; MINBPM = 50; MAXBPM = 200;\r\nper_frame_13=tess = 0; maxind = 0; qavg = 0.001; i=0; \r\nper_frame_14=loop (num_res,\r\nper_frame_15=  n = i*8;\r\nper_frame_16=  Freq  = (i/(num_res-1)+minbpm/(maxbpm-minbpm))*(maxbpm-minbpm)/60;\r\nper_frame_17=  Feder = sqr(Freq*6.2832); //Res.f = sqrt (Feder)/2pi (Hz)\r\nper_frame_18=  Excite = (vol-vol_);\r\nper_frame_19=  gmegabuf (n+4) = gmegabuf(n+2); //alte pos\r\nper_frame_20=  gmegabuf (n+1) *= 1-0.2*dt; //damping\r\nper_frame_21=  \r\nper_frame_22=  EC_Steps = int (20*Freq*dt)+1;\r\nper_frame_23=  loop (EC_Steps, // Euler-Cauchy steps\r\nper_frame_24=    Kraft = Excite - Feder*gmegabuf(n + 2) ;\r\nper_frame_25=    gmegabuf (n+1) += Kraft         * dt/EC_Steps;\r\nper_frame_26=    gmegabuf (n+2) += gmegabuf(n+1) * dt/EC_Steps;  \r\nper_frame_27=  );\r\nper_frame_28=  beatcos = gmegabuf(n+1);  beatsin = gmegabuf(n+2)*Freq*6.2832;\r\nper_frame_29=  quad = sqrt (pow(beatsin,2) + pow(beatcos,2));\r\nper_frame_30=  gmegabuf (n+3) = gmegabuf(n+3) *dec_m +  quad* (1-dec_m);\r\nper_frame_31=  if (gmegabuf(n+3) > gmegabuf (maxind*8+3), maxind =i,0);\r\nper_frame_32=  qavg = qavg+pow (gmegabuf(n+3),2);\r\nper_frame_33=  tess += beatsin* pow(gmegabuf(n+3)/gmegabuf(maxind*8+3),1)*5;\r\nper_frame_34=  i += 1;\r\nper_frame_35=);\r\nper_frame_36=qavg = sqrt (qavg/num_res);\r\nper_frame_37=certain = gmegabuf(maxind*8+3)/qavg;\r\nper_frame_38=dbl_beat = gmegabuf(maxind*8+2) * gmegabuf (maxind*8+4) < 0;\r\nper_frame_39=bcount += dbl_beat;\r\nper_frame_40=is_rbeat  = dbl_beat && (bcount%2==0);\r\nper_frame_41=bcount2 += is_rbeat;\r\nper_frame_42=\r\nper_frame_43=is_rbeat2 =is_rbeat * (bcount%2==0);\r\nper_frame_44=is_rbeat4 =is_rbeat * (bcount%4==0);\r\nper_frame_45=is_rbeat8 =is_rbeat * (bcount%8==0);\r\nper_frame_46=Freq  = (maxind/(num_res-1)+minbpm/(maxbpm-minbpm))*(maxbpm-minbpm)/60;\r\nper_frame_47=Freq_ = Freq_* dec_s + (1-dec_s)*Freq;\r\nper_frame_48=trad1 = trad1 + Freq_*dt*6.28/8;\r\nper_frame_49=\r\nper_frame_50=speed_ = speed_*dec_xs + (1-dec_xs)*Freq_*1.2;\r\nper_frame_51=\r\nper_frame_52=trig = (index==4) && is_beat;\r\nper_frame_53=if (trig, dyang = 0.007*(rand(100)-50)* rand(10)/10, 0); \r\nper_frame_54=pyr = pyr*dec_xs + (1-dec_xs)*dyang;\r\nper_frame_55=pyr2 = pyr2*dec_xs + (1-dec_xs)*pyr;\r\nper_frame_56=\r\nper_frame_57=test = 0;\r\nper_frame_58=fwx = fwx + (speed_)* sin(zang+test)*0.02/fps;\r\nper_frame_59=fwy = fwy + (speed_)* cos(zang+test)*0.02/fps;\r\nper_frame_60=\r\nper_frame_61=//#############################################\r\nper_frame_62=q5 = fwx; q6 = fwy; q7 =  0.3;\r\nper_frame_63=\r\nper_frame_64=yang = pyr2;\r\nper_frame_65=trig = is_beat * (index==26);\r\nper_frame_66=ran1 = if (trig,  int(rand(4))*-0.7/3-0.08, ran1);\r\nper_frame_67=xang =  ran1;\r\nper_frame_68=xang = -0.7 * (1.1-pow(cos(trad1/16),12));\r\nper_frame_69=zang = zang + yang/6/fps*speed_/xang;\r\nper_frame_70=pos_x = 0;\r\nper_frame_71=pos_y = 0;\r\nper_frame_72=pos_z = 0.24* (1+0.125*sin(2*zang))* aspecty*( 1.5- abs(xang)/2);\r\nper_frame_73=q30 = .1/pos_z*cos(xang);\r\nper_frame_74=\r\nper_frame_75=ox = -pos_x; oy = -pos_y; oz = pos_z;\r\nper_frame_76=mx = ox*cos(zang) - oy*sin(zang);\r\nper_frame_77=my = ox*sin(zang) + oy*cos(zang);\r\nper_frame_78=ox = mx;oy = my;\r\nper_frame_79=mx = ox*cos(yang) + oz*sin(yang);\r\nper_frame_80=mz = - ox*sin(yang) + oz*cos(yang);\r\nper_frame_81=ox = mx;oz = mz;\r\nper_frame_82=my = oy*cos(xang) - oz*sin(xang);\r\nper_frame_83=mz = oy*sin(xang) + oz*cos(xang);\r\nper_frame_84=oy = my;oz = mz;\r\nper_frame_85=q11=ox; q12 = oy; q13 = oz; //Position\r\nper_frame_86=\r\nper_frame_87=//Vektor x nach rechts\r\nper_frame_88=ox = 1; oy = 0; oz = 0;\r\nper_frame_89=mx = ox*cos(zang) - oy*sin(zang);\r\nper_frame_90=my = ox*sin(zang) + oy*cos(zang);\r\nper_frame_91=ox = mx;oy = my;\r\nper_frame_92=mx = ox*cos(yang) + oz*sin(yang);\r\nper_frame_93=mz = - ox*sin(yang) + oz*cos(yang);\r\nper_frame_94=ox = mx;oz = mz;\r\nper_frame_95=my = oy*cos(xang) - oz*sin(xang);\r\nper_frame_96=mz = oy*sin(xang) + oz*cos(xang);\r\nper_frame_97=oy = my;oz = mz;\r\nper_frame_98=q14=ox; q15 = oy; q16 = oz;\r\nper_frame_99=\r\nper_frame_100=//Vektor z nach hinten\r\nper_frame_101=ox = 0; oy = 0; oz = 1;;\r\nper_frame_102=mx = ox*cos(zang) - oy*sin(zang);\r\nper_frame_103=my = ox*sin(zang) + oy*cos(zang);\r\nper_frame_104=ox = mx;oy = my;\r\nper_frame_105=mx = ox*cos(yang) + oz*sin(yang);\r\nper_frame_106=mz = - ox*sin(yang) + oz*cos(yang);\r\nper_frame_107=ox = mx;oz = mz;\r\nper_frame_108=my = oy*cos(xang) - oz*sin(xang);\r\nper_frame_109=mz = oy*sin(xang) + oz*cos(xang);\r\nper_frame_110=oy = my;\r\nper_frame_111=oz = mz;\r\nper_frame_112=q17=ox; q18 = oy; q19 = oz;\r\nper_frame_113=\r\nper_frame_114=q20 = xang;\r\nper_frame_115=q21 = yang;\r\nper_frame_116=q22 = zang;\r\nper_frame_117=\r\nper_frame_118=q32 = aspecty;\r\nper_frame_119=q4 = min(max(0,vol-vol_),4);\r\nper_frame_120=q4 *= max(0,3*cos(trad1)-2)*8;\r\nper_frame_121=\r\nper_frame_122=q2 = is_rbeat;\r\nper_frame_123=q3 = gmegabuf(maxind*8+2)>0;\r\nper_frame_124=//q3 = bcount2%2;\r\nper_frame_125=monitor = freq_*60;\r\nper_pixel_1=zoom = 1; rot = 0; dx = 0; dy = 0; warp = 0.002;\r\nwarp_1=`#define sat saturate\r\nwarp_2=`sampler sampler_pw_noise_lq;\r\nwarp_3=`float streetx, streety,streetr,street; \r\nwarp_4=`float2 uv0, uv1, uv2, uv3;\r\nwarp_5=`\r\nwarp_6=`shader_body {\r\nwarp_7=`//uv = uv_orig;\r\nwarp_8=`uv1 = (uv-.5);\r\nwarp_9=`uv2 = sin(uv*3.1416*2)/2;\r\nwarp_10=` \r\nwarp_11=`float p1 = 100;\r\nwarp_12=`float p2 = 2;\r\nwarp_13=`streetx = 1- min(sat(p1*abs(uv2.x) -p2),sat(2*p1*abs(abs(uv1.x)-0.25)-p2)); \r\nwarp_14=`streety = 1- min(sat(p1*abs(uv2.y) -p2),sat(2*p1*abs(abs(uv1.y)-0.25)-p2));\r\nwarp_15=`streetr = 1- sat(p1*abs(rad/aspect.y*1.07-0.5) -p2*1.75);\r\nwarp_16=`\r\nwarp_17=`street = max(streetx,streety);\r\nwarp_18=`street = max(street,streetr);\r\nwarp_19=`\r\nwarp_20=`float3 orig = 0.08;\r\nwarp_21=`\r\nwarp_22=`uv2 = (uv-0.3).yx*2;\r\nwarp_23=`float3 copy = lerp (GetPixel(uv2), GetBlur1(uv2),0);\r\nwarp_24=`ret.r = lerp (orig,copy,0.5) ;\r\nwarp_25=`\r\nwarp_26=`//Kreisverkehr\r\nwarp_27=`uv3 = float2 (rad/aspect.y*1.07, ang/4*2);\r\nwarp_28=`uv3.y += (int(uv3.x*64)%8-4)*-0.024*time;\r\nwarp_29=`ret.b =  ((1*tex2D (sampler_pw_noise_lq, uv3).r) > 0.95) *(streetr>0.99) * 0.8;;\r\nwarp_30=`\r\nwarp_31=`\r\nwarp_32=`//horizontale Fahrtrichtung\r\nwarp_33=`uv3 = uv_orig*texsize.xy*texsize_noise_lq.zw*float2(0.5,1);\r\nwarp_34=`uv3.x += (int(uv_orig.y*texsize_noise_lq.y)%8-4)*time*.015;\r\nwarp_35=`ret.b +=  ((1*tex2D (sampler_pw_noise_lq, uv3).r) > 0.94)* (streety>0.99) ;;\r\nwarp_36=`\r\nwarp_37=`//vertikale Fahrtrichtung\r\nwarp_38=`uv3 = uv_orig*texsize.xy*texsize_noise_lq.zw*float2(1,0.5);\r\nwarp_39=`uv3.y += (int(uv_orig.x*texsize_noise_lq.x)%8-4)*time*.023;\r\nwarp_40=`ret.b +=  ((1*tex2D (sampler_pw_noise_lq, uv3).r) > 0.94)* (streetx>0.99) ;;\r\nwarp_41=`\r\nwarp_42=`\r\nwarp_43=`//Lichter\r\nwarp_44=`ret.b += (frac(32*ret.r+time*0.002)>0.95) * !street*0.7;\r\nwarp_45=`ret.b += street*0.15;\r\nwarp_46=`\r\nwarp_47=`ret.b = max (ret.b*1, GetPixel(uv).b *0.75 * (GetPixel(uv).b > 0));\r\nwarp_48=`ret.r = ret.r*(1-street) ;\r\nwarp_49=`\r\nwarp_50=`\r\nwarp_51=`\r\nwarp_52=`}\r\ncomp_1=`sampler sampler_pw_noise_lq;\r\ncomp_2=`static const float quality = 5, depth = q30, z0=4, scale = 1.0/quality*-depth/z0;\r\ncomp_3=`float3 neu, rsl, rsl0, rsl00, screen3;\r\ncomp_4=`float2 uv0, uv1, uv2, uv4, uv5, rsk, dz1;\r\ncomp_5=`float  lprof,noise,cloud,gmask,dx,dy,test,tmp;\r\ncomp_6=`static float lav_gnd = 0;\r\ncomp_7=`static float3 mov = float3 (q5,q6, q7);\r\ncomp_8=`static float3 t = float3(q14,q15,q16);\r\ncomp_9=`static float3 s = float3(q17,q18,q19);\r\ncomp_10=`static float3 ts = -cross(s,t);\r\ncomp_11=`static float3 pos = float3 (q11,q12,q13);\r\ncomp_12=`\r\ncomp_13=`float3 project (float gnd) {  float z;\r\ncomp_14=`  z = -1/mul(cross(ts,-t),screen3); z = z-gnd ;\r\ncomp_15=`  gmask = (z >= -6) * (z <= 6);\r\ncomp_16=`  return float3(mul(float2x3(ts,t),cross(pos,screen3))*z*gmask*aspect.yx,-z);}\r\ncomp_17=`\r\ncomp_18=`float3 GetBlur0 ( float2 uvi) {float3 tmp;\r\ncomp_19=`  tmp = GetPixel(uvi)  + GetPixel (uvi+texsize.zw*float2(1,0))\r\ncomp_20=`      + GetPixel (uvi+texsize.zw*float2(-1,0)) + GetPixel (uvi+texsize.zw*float2(0,1))\r\ncomp_21=`      + GetPixel (uvi+texsize.zw*float2(0,-1));\r\ncomp_22=`  return lerp (tmp*0.2, GetBlur1(uvi), 1);} \r\ncomp_23=`\r\ncomp_24=`shader_body {\r\ncomp_25=`//uv += 0.01*sin(7*length(uv-0.5)-q2) * normalize(uv-0.5);\r\ncomp_26=`screen3 = float3 ((uv-float2(.5,.5))*aspect.xy,1);//wirkt wie zoom / Tele ###\r\ncomp_27=`\r\ncomp_28=`lav_gnd = -0.022; //#####\r\ncomp_29=`  for (int m=1; m <= quality; m++) {\r\ncomp_30=`    rsl = (project (lav_gnd)+float3 (mov));\r\ncomp_31=`    lprof = floor(z0*1-2*z0*GetPixel(rsl.xy).r )*scale ;\r\ncomp_32=`    lav_gnd += lprof;\r\ncomp_33=`  }\r\ncomp_34=`rsl = project (lav_gnd)+ mov; //#######\r\ncomp_35=`float streetlevel = saturate(-10*depth-12*lav_gnd);\r\ncomp_36=`float cmask = streetlevel > 0.05;\r\ncomp_37=`\r\ncomp_38=`float3 backnoise = lerp (tex2D (sampler_noise_hq,(rsl.xy)/6), 0.5, 0.2);\r\ncomp_39=`float3 lights = .1/length(cos(rsl.xy*26+rand_preset.xy*1.1))* backnoise;\r\ncomp_40=`  \r\ncomp_41=`float d = 0.0008;\r\ncomp_42=`dy = GetPixel(rsl.xy+d) - GetPixel(rsl.xy-d);\r\ncomp_43=`dy += (GetPixel(rsl*3+d) - GetPixel(rsl*3-d))*saturate(lav_gnd/depth+1)/2;\r\ncomp_44=`\r\ncomp_45=`rsl00 = project (-depth);\r\ncomp_46=`rsl0  = rsl00+mov;\r\ncomp_47=`ret = saturate(dy)*lights* (0.2+tex2D(sampler_noise_hq,rsl0.xy*0.06).r)*14;\r\ncomp_48=`ret += lights*saturate(-6*lav_gnd* (rand_preset.x+0.2))*3;\r\ncomp_49=`\r\ncomp_50=`ret *= 1+12*GetBlur0(frac(rsl0.xy)).b *saturate(streetlevel*2);\r\ncomp_51=`float3 car = GetPixel(frac(rsl0.xy)).b;\r\ncomp_52=`if (GetPixel(rsl0.xy).r >0.1) {car *= tex2D(sampler_noise_lq,rsl0.xy)*2;};\r\ncomp_53=`ret += car * cmask;\r\ncomp_54=`\r\ncomp_55=`//distant fog\r\ncomp_56=`ret = lerp (ret, float3(0.2,0.1,0), saturate(pow(rsl0.z/3,2)));\r\ncomp_57=`\r\ncomp_58=`float flash = 0.02/length(sin(6*rsl0.xy+2*dy+3*rand_frame.zx));\r\ncomp_59=`ret += flash*saturate(0.2-4*lav_gnd)* q4 * float3(0.2,.5,1) *(1-uv.y);\r\ncomp_60=`//ret += q2 * (lav_gnd + dy) * float3 (0,0.5,1) * (1-uv.y);\r\ncomp_61=`//ret = GetPixel(uv);\r\ncomp_62=`\r\ncomp_63=`}\r\ncomp_64=`\r\ncomp_65=`written by martin\r\ncomp_66=`END\r\n"
}
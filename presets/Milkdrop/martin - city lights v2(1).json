{
  "name": "martin - city lights v2(1)",
  "description": "martin - city lights v2(1)",
  "milkdrop_raw": "MILKDROP_PRESET_VERSION=201\r\nPSVERSION=3\r\nPSVERSION_WARP=3\r\nPSVERSION_COMP=3\r\n[preset00]\r\nfRating=5.000000\r\nfGammaAdj=1.980\r\nfDecay=0.500\r\nfVideoEchoZoom=1.000\r\nfVideoEchoAlpha=0.500\r\nnVideoEchoOrientation=3\r\nnWaveMode=7\r\nbAdditiveWaves=1\r\nbWaveDots=0\r\nbWaveThick=1\r\nbModWaveAlphaByVolume=0\r\nbMaximizeWaveColor=0\r\nbTexWrap=1\r\nbDarkenCenter=0\r\nbRedBlueStereo=0\r\nbBrighten=0\r\nbDarken=1\r\nbSolarize=0\r\nbInvert=0\r\nfWaveAlpha=1.059\r\nfWaveScale=8.991\r\nfWaveSmoothing=0.000\r\nfWaveParam=0.000\r\nfModWaveAlphaStart=0.000\r\nfModWaveAlphaEnd=0.000\r\nfWarpAnimSpeed=1.459\r\nfWarpScale=2.007\r\nfZoomExponent=1.00000\r\nfShader=0.000\r\nzoom=0.99990\r\nrot=0.00000\r\ncx=0.500\r\ncy=0.500\r\ndx=0.00000\r\ndy=0.00000\r\nwarp=0.01000\r\nsx=0.99990\r\nsy=1.00000\r\nwave_r=0.000\r\nwave_g=0.000\r\nwave_b=0.000\r\nwave_x=0.500\r\nwave_y=0.500\r\nob_size=0.000\r\nob_r=0.000\r\nob_g=0.000\r\nob_b=0.000\r\nob_a=1.000\r\nib_size=0.260\r\nib_r=0.250\r\nib_g=0.250\r\nib_b=0.250\r\nib_a=0.000\r\nnMotionVectorsX=64.000\r\nnMotionVectorsY=48.000\r\nmv_dx=0.000\r\nmv_dy=0.000\r\nmv_l=1.850\r\nmv_r=0.500\r\nmv_g=0.500\r\nmv_b=0.500\r\nmv_a=0.000\r\nb1n=0.000\r\nb2n=0.000\r\nb3n=0.000\r\nb1x=0.990\r\nb2x=1.000\r\nb3x=1.000\r\nb1ed=0.000\r\nwavecode_0_enabled=1\r\nwavecode_0_samples=200\r\nwavecode_0_sep=0\r\nwavecode_0_bSpectrum=0\r\nwavecode_0_bUseDots=1\r\nwavecode_0_bDrawThick=0\r\nwavecode_0_bAdditive=1\r\nwavecode_0_scaling=0.89152\r\nwavecode_0_smoothing=0.82000\r\nwavecode_0_r=0.000\r\nwavecode_0_g=0.000\r\nwavecode_0_b=1.000\r\nwavecode_0_a=0.600\r\nwave_0_init1=t1 = 1 + (rand(101)*.01 - rand(101)*.01)*.3;\r\nwave_0_init2=t2 = 1 + (rand(101)*.01 - rand(101)*.01)*.3;\r\nwave_0_init3=t3 = 1 + (rand(101)*.01 - rand(101)*.01)*.3;\r\nwave_0_init4=t4 = 1 + (rand(101)*.01 - rand(101)*.01)*.3;\r\nwave_0_init5=t5 = 1 + (rand(101)*.01 - rand(101)*.01)*.3;\r\nwave_0_init6=t6 = 1 + (rand(101)*.01 - rand(101)*.01)*.3;\r\nwave_0_init7=t7 = 1 + (rand(101)*.01 - rand(101)*.01)*.3;\r\nwave_0_init8=t8 = 1 + (rand(101)*.01 - rand(101)*.01)*.3;\r\nwave_0_init9=\r\nwave_0_per_frame1=t1 = 0;\r\nwave_0_per_point1=row = (t1/2)%2;\r\nwave_0_per_point2=wid = (t1+2)%4;\r\nwave_0_per_point3=dx = 0.014* (row -0.5) + 0.0025* (wid-1.5);\r\nwave_0_per_point4=x = 0.5 + dx;\r\nwave_0_per_point5=\r\nwave_0_per_point6=y = int(t1/4)/50;\r\nwave_0_per_point7=y = y - int(y);\r\nwave_0_per_point8=\r\nwave_0_per_point9=t1 += 1;\r\nwavecode_1_enabled=1\r\nwavecode_1_samples=200\r\nwavecode_1_sep=0\r\nwavecode_1_bSpectrum=0\r\nwavecode_1_bUseDots=1\r\nwavecode_1_bDrawThick=1\r\nwavecode_1_bAdditive=1\r\nwavecode_1_scaling=0.89152\r\nwavecode_1_smoothing=1.00000\r\nwavecode_1_r=0.000\r\nwavecode_1_g=0.800\r\nwavecode_1_b=1.000\r\nwavecode_1_a=1.000\r\nwave_1_init1=t1 = 1 + (rand(101)*.01 - rand(101)*.01)*.3;\r\nwave_1_init2=t2 = 1 + (rand(101)*.01 - rand(101)*.01)*.3;\r\nwave_1_init3=t3 = 1 + (rand(101)*.01 - rand(101)*.01)*.3;\r\nwave_1_init4=t4 = 1 + (rand(101)*.01 - rand(101)*.01)*.3;\r\nwave_1_init5=t5 = 1 + (rand(101)*.01 - rand(101)*.01)*.3;\r\nwave_1_init6=t6 = 1 + (rand(101)*.01 - rand(101)*.01)*.3;\r\nwave_1_init7=t7 = 1 + (rand(101)*.01 - rand(101)*.01)*.3;\r\nwave_1_init8=t8 = 1 + (rand(101)*.01 - rand(101)*.01)*.3;\r\nwave_1_init9=\r\nwave_1_per_frame1=t1 = 0;\r\nwave_1_per_point1=x = sample; \r\nwave_1_per_point2=y = 0.5 - 0.5/q32 *((t1)%2-0.5);\r\nwave_1_per_point3=y += 0.023*((t1/2)%2-0.5)/q32;\r\nwave_1_per_point4=\r\nwave_1_per_point5=a = (int(t1/4+q2))%4 >=2;\r\nwave_1_per_point6=t1 +=1 ;\r\nwavecode_2_enabled=0\r\nwavecode_2_samples=512\r\nwavecode_2_sep=0\r\nwavecode_2_bSpectrum=0\r\nwavecode_2_bUseDots=0\r\nwavecode_2_bDrawThick=0\r\nwavecode_2_bAdditive=0\r\nwavecode_2_scaling=0.01348\r\nwavecode_2_smoothing=0.00000\r\nwavecode_2_r=1.000\r\nwavecode_2_g=0.600\r\nwavecode_2_b=0.000\r\nwavecode_2_a=0.310\r\nwave_2_init1=t1 = 1 + (rand(101)*.01 - rand(101)*.01)*.3;\r\nwave_2_init2=t2 = 1 + (rand(101)*.01 - rand(101)*.01)*.3;\r\nwave_2_init3=t3 = 1 + (rand(101)*.01 - rand(101)*.01)*.3;\r\nwave_2_init4=t4 = 1 + (rand(101)*.01 - rand(101)*.01)*.3;\r\nwave_2_init5=t5 = 1 + (rand(101)*.01 - rand(101)*.01)*.3;\r\nwave_2_init6=t6 = 1 + (rand(101)*.01 - rand(101)*.01)*.3;\r\nwave_2_init7=t7 = 1 + (rand(101)*.01 - rand(101)*.01)*.3;\r\nwave_2_init8=t8 = 1 + (rand(101)*.01 - rand(101)*.01)*.3;\r\nwave_2_init9=\r\nwave_2_per_frame1=trel = q1-.33;\r\nwave_2_per_frame2=t1 = int(trel)/3;\r\nwave_2_per_frame3=t2 = trel - int(trel);\r\nwave_2_per_frame4=\r\nwave_2_per_frame5=\r\nwave_2_per_frame6=\r\nwavecode_3_enabled=0\r\nwavecode_3_samples=512\r\nwavecode_3_sep=0\r\nwavecode_3_bSpectrum=1\r\nwavecode_3_bUseDots=0\r\nwavecode_3_bDrawThick=0\r\nwavecode_3_bAdditive=0\r\nwavecode_3_scaling=1.00000\r\nwavecode_3_smoothing=0.50000\r\nwavecode_3_r=1.000\r\nwavecode_3_g=0.600\r\nwavecode_3_b=0.000\r\nwavecode_3_a=1.000\r\nwave_3_per_frame1=trel = q1-.66;\r\nwave_3_per_frame2=t1 = int(trel);\r\nwave_3_per_frame3=t2 = trel - int(trel);\r\nshapecode_0_enabled=1\r\nshapecode_0_sides=12\r\nshapecode_0_additive=0\r\nshapecode_0_thickOutline=0\r\nshapecode_0_textured=0\r\nshapecode_0_num_inst=49\r\nshapecode_0_x=0.200\r\nshapecode_0_y=0.900\r\nshapecode_0_rad=0.01000\r\nshapecode_0_ang=0.00000\r\nshapecode_0_tex_ang=0.00000\r\nshapecode_0_tex_zoom=0.85169\r\nshapecode_0_r=0.000\r\nshapecode_0_g=1.000\r\nshapecode_0_b=1.000\r\nshapecode_0_a=1.000\r\nshapecode_0_r2=0.000\r\nshapecode_0_g2=0.000\r\nshapecode_0_b2=0.000\r\nshapecode_0_a2=1.000\r\nshapecode_0_border_r=0.000\r\nshapecode_0_border_g=0.000\r\nshapecode_0_border_b=0.000\r\nshapecode_0_border_a=0.200\r\nshape_0_per_frame1=sides = 4;\r\nshape_0_per_frame2=nx = instance%6;\r\nshape_0_per_frame3=ny = int (instance/6);\r\nshape_0_per_frame4=\r\nshape_0_per_frame5=if (instance <= 35, //Kreuzungen\r\nshape_0_per_frame6=  x = 0.5 + (nx-3)/4; \r\nshape_0_per_frame7=  y = 0.5 + (ny-3)/4; \r\nshape_0_per_frame8=  rad = 0.04;\r\nshape_0_per_frame9=  r=0; r2 = 0;\r\nshape_0_per_frame10=\r\nshape_0_per_frame11=,\r\nshape_0_per_frame12=  if (instance < 38, //Kreuz. Kreisverkehr li/re\r\nshape_0_per_frame13=    x = 0.5 - 0.47/q32 * (instance%2-0.5);\r\nshape_0_per_frame14=    y = 0.5;      \r\nshape_0_per_frame15=    rad = 0.06;\r\nshape_0_per_frame16=     r=0; r2 = 0.6;\r\nshape_0_per_frame17=, if (instance < 45, //Kreuz. Kreisverkehr o/u\r\nshape_0_per_frame18=     x = 0.5 - 0.0/q32 * (instance%3-1);\r\nshape_0_per_frame19=     y = 0.5 - 0.47*(int (instance/3)%2-0.5);      \r\nshape_0_per_frame20=     rad = 0.06;\r\nshape_0_per_frame21=     r=0.5; r2 = 0.3; ang = 0; sides = 4;\r\nshape_0_per_frame22=,0\r\nshape_0_per_frame23=);\r\nshape_0_per_frame24=);\r\nshape_0_per_frame25=);\r\nshape_0_per_frame26=\r\nshape_0_per_frame27=g = 0; g2 = 0;\r\nshape_0_per_frame28=b = nx%2; b2 = !q3 * (instance%4==1);\r\nshape_0_per_frame29=border_b = 1-b;\r\nshape_0_per_frame30=a = 1;\r\nshape_0_per_frame31=a2 = a;\r\nshape_0_per_frame32=\r\nshape_0_per_frame33=\r\nshape_0_per_frame34=//sonstige Effekte\r\nshape_0_per_frame35=if (instance >= 45,\r\nshape_0_per_frame36=  x = 0.5 + ((instance/2)%2-0.5)*0.5; \r\nshape_0_per_frame37=  y = 0.5 + (((instance)%2)-0.5)*0.5; \r\nshape_0_per_frame38=  rad = 0.04* (1- ((q2%4)/4)*0.8); r= 0; r2 = 0; g = 0; g2 = 0; b = 0; b2 = 0;\r\nshape_0_per_frame39=  a = 0; a2 = 0;\r\nshape_0_per_frame40=  border_b = 1; border_g = 0; thick = 1; \r\nshape_0_per_frame41=,0);\r\nshape_0_per_frame42=\r\nshapecode_1_enabled=1\r\nshapecode_1_sides=4\r\nshapecode_1_additive=1\r\nshapecode_1_thickOutline=1\r\nshapecode_1_textured=0\r\nshapecode_1_num_inst=70\r\nshapecode_1_x=0.600\r\nshapecode_1_y=0.500\r\nshapecode_1_rad=0.03300\r\nshapecode_1_ang=0.00000\r\nshapecode_1_tex_ang=0.00000\r\nshapecode_1_tex_zoom=6.16617\r\nshapecode_1_r=0.400\r\nshapecode_1_g=1.000\r\nshapecode_1_b=0.700\r\nshapecode_1_a=0.900\r\nshapecode_1_r2=0.000\r\nshapecode_1_g2=0.000\r\nshapecode_1_b2=0.000\r\nshapecode_1_a2=1.000\r\nshapecode_1_border_r=0.000\r\nshapecode_1_border_g=0.000\r\nshapecode_1_border_b=0.000\r\nshapecode_1_border_a=1.000\r\nshape_1_per_frame1=\r\nshape_1_per_frame2=\r\nshape_1_per_frame3=x = 0.5 + 0.4*sin(instance*instance*reg01);\r\nshape_1_per_frame4=//y = 0.5 + 0.4*sin(instance*reg02+reg03);\r\nshape_1_per_frame5=\r\nshape_1_per_frame6=rany = (65*instance+37+reg02)%4096;\r\nshape_1_per_frame7=y = 0.5 + 0.4 * (rany/2084-1);\r\nshape_1_per_frame8=\r\nshape_1_per_frame9=\r\nshape_1_per_frame10=rad = 0.12 + 0.06*sin(instance*34.253);\r\nshape_1_per_frame11=\r\nshape_1_per_frame12=\r\nshape_1_per_frame13=g=0; g2 = 0 ;\r\nshape_1_per_frame14=r =  (instance%2); r2 = 1;\r\nshape_1_per_frame15=b = 0; b2 = 0.25 * (instance%3==1);\r\nshape_1_per_frame16=a = 0.9;\r\nshape_1_per_frame17=a2 = 0.55;\r\nshape_1_per_frame18=\r\nshape_1_per_frame19=border_g = ((instance+2)%4==q20%4) * (instance%2==1);\r\nshape_1_per_frame20=\r\nshape_1_per_frame21=//border_g = (instance+q20)%8>6;\r\nshape_1_per_frame22=//border_g = 0;\r\nshape_1_per_frame23=border_b = border_g;\r\nshape_1_per_frame24=\r\nshapecode_2_enabled=1\r\nshapecode_2_sides=8\r\nshapecode_2_additive=1\r\nshapecode_2_thickOutline=0\r\nshapecode_2_textured=0\r\nshapecode_2_num_inst=32\r\nshapecode_2_x=0.873\r\nshapecode_2_y=0.130\r\nshapecode_2_rad=0.29166\r\nshapecode_2_ang=0.00000\r\nshapecode_2_tex_ang=2.51327\r\nshapecode_2_tex_zoom=0.74415\r\nshapecode_2_r=0.000\r\nshapecode_2_g=0.000\r\nshapecode_2_b=0.000\r\nshapecode_2_a=1.000\r\nshapecode_2_r2=0.000\r\nshapecode_2_g2=0.000\r\nshapecode_2_b2=0.000\r\nshapecode_2_a2=0.400\r\nshapecode_2_border_r=0.800\r\nshapecode_2_border_g=0.500\r\nshapecode_2_border_b=0.000\r\nshapecode_2_border_a=0.000\r\nshape_2_per_frame1=arg = instance/num_inst*6.28;\r\nshape_2_per_frame2=\r\nshape_2_per_frame3=radi = 0.214/q32;\r\nshape_2_per_frame4=x = 0.5 + radi*cos(arg);\r\nshape_2_per_frame5=y = 0.5 + radi*sin(arg)*q32;\r\nshape_2_per_frame6=\r\nshape_2_per_frame7=r = 0; b = 1; g = 1; \r\nshape_2_per_frame8=r2 = 0; b2 = 1; g2 = 1; \r\nshape_2_per_frame9=a2 = 0.4;\r\nshape_2_per_frame10=\r\nshape_2_per_frame11=a = 1; rad = 0.0075 * min(0,sin((instance+q2)/num_inst*3.1416*8));\r\nshapecode_3_enabled=1\r\nshapecode_3_sides=4\r\nshapecode_3_additive=0\r\nshapecode_3_thickOutline=0\r\nshapecode_3_textured=0\r\nshapecode_3_num_inst=9\r\nshapecode_3_x=0.550\r\nshapecode_3_y=0.350\r\nshapecode_3_rad=0.03301\r\nshapecode_3_ang=6.28319\r\nshapecode_3_tex_ang=0.00000\r\nshapecode_3_tex_zoom=1.31212\r\nshapecode_3_r=0.000\r\nshapecode_3_g=1.000\r\nshapecode_3_b=0.000\r\nshapecode_3_a=1.000\r\nshapecode_3_r2=0.000\r\nshapecode_3_g2=0.600\r\nshapecode_3_b2=0.000\r\nshapecode_3_a2=0.000\r\nshapecode_3_border_r=0.000\r\nshapecode_3_border_g=1.000\r\nshapecode_3_border_b=0.000\r\nshapecode_3_border_a=0.000\r\nshape_3_per_frame1=\r\nshape_3_per_frame2=\r\nshape_3_per_frame3=haus = int(instance/4);\r\nshape_3_per_frame4=if (instance <= 7,\r\nshape_3_per_frame5=  x0 = 0.5 + 0.4*sin(haus*haus*reg01);\r\nshape_3_per_frame6=  y0 = 0.5 + 0.4*sin(haus*reg02+reg03);\r\nshape_3_per_frame7=\r\nshape_3_per_frame8=\r\nshape_3_per_frame9=  rad0 = 0.12 + 0.06*sin(haus*34.253);\r\nshape_3_per_frame10=\r\nshape_3_per_frame11=  sel = instance%4;\r\nshape_3_per_frame12=  scale = 0.25;\r\nshape_3_per_frame13=  if (sel==0, x =x0+rad0*scale; y=y0+rad0*scale*q32,0);\r\nshape_3_per_frame14=  if (sel==1, x =x0-rad0*scale; y=y0+rad0*scale*q32,0);\r\nshape_3_per_frame15=  if (sel==3, x =x0+rad0*scale; y=y0-rad0*scale*q32,0);\r\nshape_3_per_frame16=  if (sel==2, x =x0-rad0*scale; y=y0-rad0*scale*q32,0);\r\nshape_3_per_frame17=  rad = 0.025;\r\nshape_3_per_frame18=\r\nshape_3_per_frame19=  r =   1; r2 = 0;\r\nshape_3_per_frame20=  b = 1; b2 = 0;\r\nshape_3_per_frame21=  a = 1 ;\r\nshape_3_per_frame22=  a2 = a;\r\nshape_3_per_frame23=\r\nshape_3_per_frame24=  g = ((instance+q20)%4==0)*0.8+0.2;\r\nshape_3_per_frame25=  g2 = 0;,\r\nshape_3_per_frame26=\r\nshape_3_per_frame27=//spezielle Form im Zentrum fuer Laser\r\nshape_3_per_frame28=\r\nshape_3_per_frame29=x = 0.5; y = 0.5; g = 0; b = 0; r = .2 ;r2 = 1;  rad = 0.05; additive = 0; a = 0.8; a2 = a;\r\nshape_3_per_frame30=);\r\nper_frame_init_1=n = 0; loop (10000, gmegabuf(n)=0; n +=1; );\r\nper_frame_init_2=\r\nper_frame_init_3=reg01 = rand(100)+15;\r\nper_frame_init_4=reg02 = rand(100)+10;\r\nper_frame_init_5=reg03 = rand(10)/80*0;\r\nper_frame_init_6=\r\nper_frame_init_7=fwx = rand(100);\r\nper_frame_init_8=fwy = rand(100);\r\nper_frame_init_9=zang = rand(6);\r\nper_frame_init_10=dyang = 0.007*(rand(100)-50);\r\nper_frame_init_11=\r\nper_frame_init_12=ran1 = -0.5;\r\nper_frame_init_13=trad1 = rand(6);\r\nper_frame_init_14=trad2 = rand(6);\r\nper_frame_init_15=speed_= (bass_att + mid_att + treb_att)*2;\r\nper_frame_1=//dt = dt*0.8 + 0.2/fps;\r\nper_frame_2=dt = min(2/fps,time-t01);\r\nper_frame_3=t01 = time;\r\nper_frame_4=dec_m = 1 - 6*dt; dec_s = 1 - 2*dt; dec_xs = 1-dt;\r\nper_frame_5=vol = bass+treb; \r\nper_frame_6=vol_ = vol_*dec_m + (1-dec_m)*vol;\r\nper_frame_7=is_beat = above(vol, .4+vol_+peak) * above (time, t0+.2);\r\nper_frame_8=t0 = is_beat*time + (1-is_beat)*t0;\r\nper_frame_9=peak = is_beat * vol + (1-is_beat)*peak*dec_m;\r\nper_frame_10=index = (index + is_beat) %16;\r\nper_frame_11=index2 = (index2 + is_beat*bnot(index))%8;\r\nper_frame_12=index3 = (index3 + is_beat* if(bnot(rand(8)%2),-1,1)*bnot(index%16))%6;\r\nper_frame_13=\r\nper_frame_14=num_res = 300; MINBPM = 50; MAXBPM = 300;\r\nper_frame_15=tess = 0; maxind = 0; qavg = 0.001; i=0; avg = 0.001;\r\nper_frame_16=loop (num_res,\r\nper_frame_17=  n = i*8;\r\nper_frame_18=  Freq  = (i/(num_res-1)+minbpm/(maxbpm-minbpm))*(maxbpm-minbpm)/60;\r\nper_frame_19=  Feder = sqr(Freq*6.2832); //Res.f = sqrt (Feder)/2pi (Hz)\r\nper_frame_20=  Excite = atan(vol-vol_);\r\nper_frame_21=  gmegabuf (n+4) = gmegabuf(n+2); //alte pos\r\nper_frame_22=  gmegabuf (n+1) *= 1-0.25*dt; //damping\r\nper_frame_23=  \r\nper_frame_24=  EC_Steps = int (20*Freq*dt)+1;\r\nper_frame_25=  loop (EC_Steps, // Euler-Cauchy steps\r\nper_frame_26=    Kraft = Excite - Feder*gmegabuf(n + 2) ;\r\nper_frame_27=    gmegabuf (n+1) += Kraft         * dt/EC_Steps;\r\nper_frame_28=    gmegabuf (n+2) += gmegabuf(n+1) * dt/EC_Steps;  \r\nper_frame_29=  );\r\nper_frame_30=  beatcos = gmegabuf(n+1);  beatsin = gmegabuf(n+2)*Freq*6.2832;\r\nper_frame_31=  quad = sqrt (pow(beatsin,2) + pow(beatcos,2));\r\nper_frame_32=  gmegabuf (n+3) = gmegabuf(n+3) *dec_m +  quad* (1-dec_m);\r\nper_frame_33=  if (gmegabuf(n+3) > gmegabuf (maxind*8+3), maxind =i,0);\r\nper_frame_34=  qavg = qavg+pow (gmegabuf(n+3),2);\r\nper_frame_35=  avg =  avg + gmegabuf(n+3);\r\nper_frame_36=  tess += beatsin* pow(gmegabuf(n+3)/gmegabuf(maxind*8+3),1)*5;\r\nper_frame_37=  i += 1;\r\nper_frame_38=);\r\nper_frame_39=qavg = sqrt (qavg/num_res); avg /= num_res;\r\nper_frame_40=qdev = 0; i =0;\r\nper_frame_41=loop (num_res,\r\nper_frame_42=  qdev += pow(gmegabuf(i+3)-qavg,2);\r\nper_frame_43=  i += 8;\r\nper_frame_44=);\r\nper_frame_45=qdev = sqrt (qdev/num_res);\r\nper_frame_46=\r\nper_frame_47=certain = gmegabuf(maxind*8+3)/qavg;\r\nper_frame_48=dbl_beat = gmegabuf(maxind*8+2) * gmegabuf (maxind*8+4) < 0;\r\nper_frame_49=bcount += dbl_beat;\r\nper_frame_50=is_rbeat  = dbl_beat && (bcount%2==0);\r\nper_frame_51=bcount2 += is_rbeat;\r\nper_frame_52=\r\nper_frame_53=is_rbeat2 =is_rbeat * (bcount%2==0);\r\nper_frame_54=is_rbeat4 =is_rbeat * (bcount%4==0);\r\nper_frame_55=is_rbeat8 =is_rbeat * (bcount%8==0);\r\nper_frame_56=Freq  = (maxind/(num_res-1)+minbpm/(maxbpm-minbpm))*(maxbpm-minbpm)/60;\r\nper_frame_57=Freq_ = Freq_* dec_s + (1-dec_s)*Freq;\r\nper_frame_58=trad1 = trad1 + Freq_*dt*6.28/8;\r\nper_frame_59=\r\nper_frame_60=sp = min(8,qdev/avg*8);\r\nper_frame_61=speed_ = speed_*dec_xs + (1-dec_xs)*sp;\r\nper_frame_62=\r\nper_frame_63=trig = (index%8==0) && is_beat;\r\nper_frame_64=if (trig, dyang = 0.007*(rand(100)-50)*(rand(10)/10), 0); \r\nper_frame_65=pyr =  pyr *dec_xs + (1-dec_xs)*dyang;\r\nper_frame_66=pyr2 = pyr2*dec_xs + (1-dec_xs)*pyr;\r\nper_frame_67=\r\nper_frame_68=test = pyr2*2 * sin(time/2)*0;\r\nper_frame_69=fwx = fwx + (speed_)* sin(zang+test)*0.02*dt;\r\nper_frame_70=fwy = fwy + (speed_)* cos(zang+test)*0.02*dt;\r\nper_frame_71=\r\nper_frame_72=//#############################################\r\nper_frame_73=q5 = fwx; q6 = fwy; q7 =  0.3;\r\nper_frame_74=//q5 = 0.4; q6 = 0.6;\r\nper_frame_75=yang = pyr2 ;\r\nper_frame_76=xang = -0.75 * (1.1-pow(cos(trad1/16),12));\r\nper_frame_77=zang = zang + yang/6/fps*speed_/xang;\r\nper_frame_78=pos_z = 0.25* (1+0.3*sin(1.2*zang))* aspecty*( 1.5- abs(xang)/2);\r\nper_frame_79=\r\nper_frame_80=\r\nper_frame_81=ox = 0; oy = 0; oz = pos_z;\r\nper_frame_82=mx = ox*cos(zang) - oy*sin(zang);\r\nper_frame_83=my = ox*sin(zang) + oy*cos(zang);\r\nper_frame_84=ox = mx;oy = my;\r\nper_frame_85=mx = ox*cos(yang) + oz*sin(yang);\r\nper_frame_86=mz = - ox*sin(yang) + oz*cos(yang);\r\nper_frame_87=ox = mx;oz = mz;\r\nper_frame_88=my = oy*cos(xang) - oz*sin(xang);\r\nper_frame_89=mz = oy*sin(xang) + oz*cos(xang);\r\nper_frame_90=oy = my;oz = mz;\r\nper_frame_91=q11=ox; q12 = oy; q13 = oz; //Position\r\nper_frame_92=\r\nper_frame_93=//Vektor x nach rechts\r\nper_frame_94=ox = 1; oy = 0; oz = 0;\r\nper_frame_95=mx = ox*cos(zang) - oy*sin(zang);\r\nper_frame_96=my = ox*sin(zang) + oy*cos(zang);\r\nper_frame_97=ox = mx;oy = my;\r\nper_frame_98=mx = ox*cos(yang) + oz*sin(yang);\r\nper_frame_99=mz = - ox*sin(yang) + oz*cos(yang);\r\nper_frame_100=ox = mx;oz = mz;\r\nper_frame_101=my = oy*cos(xang) - oz*sin(xang);\r\nper_frame_102=mz = oy*sin(xang) + oz*cos(xang);\r\nper_frame_103=oy = my;oz = mz;\r\nper_frame_104=q14=ox; q15 = oy; q16 = oz;\r\nper_frame_105=\r\nper_frame_106=//Vektor z nach hinten\r\nper_frame_107=ox = 0; oy = 0; oz = 1;;\r\nper_frame_108=mx = ox*cos(zang) - oy*sin(zang);\r\nper_frame_109=my = ox*sin(zang) + oy*cos(zang);\r\nper_frame_110=ox = mx;oy = my;\r\nper_frame_111=mx = ox*cos(yang) + oz*sin(yang);\r\nper_frame_112=mz = - ox*sin(yang) + oz*cos(yang);\r\nper_frame_113=ox = mx;oz = mz;\r\nper_frame_114=my = oy*cos(xang) - oz*sin(xang);\r\nper_frame_115=mz = oy*sin(xang) + oz*cos(xang);\r\nper_frame_116=oy = my;\r\nper_frame_117=oz = mz;\r\nper_frame_118=q17=ox; q18 = oy; q19 = oz;\r\nper_frame_119=\r\nper_frame_120=\r\nper_frame_121=if (abs(maxind-mio)>1, cchange=time, 0);\r\nper_frame_122=mio = maxind;\r\nper_frame_123=\r\nper_frame_124=bc =  if ((time-cchange>2)*(certain>2.5), bcount, bc);\r\nper_frame_125=bc2 = if ((time-cchange>2)*(certain>3.5), bcount2, bc2);\r\nper_frame_126=q2=bc;\r\nper_frame_127=q20=bc2;\r\nper_frame_128=q3 = (gmegabuf(maxind*8+1)>0) * (time-cchange>2);\r\nper_frame_129=push += vol*dt*0.04;\r\nper_frame_130=q1 = push;\r\nper_frame_131=\r\nper_frame_132=//flash\r\nper_frame_133=q4 = min(max(0,vol-vol_),8);\r\nper_frame_134=q4 *= max(0,3*cos(trad1)-2)/3 * (time-cchange<4);\r\nper_frame_135=\r\nper_frame_136=q24 = max(0,0.7+gmegabuf(maxind*8+1)/(gmegabuf(maxind*8+3) + 0.001));\r\nper_frame_137=q25 = pos_z;\r\nper_frame_138=\r\nper_frame_139=mul = 1/(abs(sin(xang)) + 0.05);\r\nper_frame_140=q21 = (1-pow(sin(bcount/2),6))*q24 * mul;\r\nper_frame_141=q22 = (1-pow(sin(bcount/3),6))*q24 * mul;\r\nper_frame_142=q23 = (1-pow(sin(bcount/5),6))*q24 * mul;\r\nper_frame_143=q30 = .1/pos_z*cos(xang);\r\nper_frame_144=\r\nper_frame_145=q31 = bcount;\r\nper_frame_146=q32 = aspecty;\r\nper_frame_147=monitor = reg01/reg02 /3.1416;\r\nper_pixel_1=zoom = 1; rot = 0; dx = 0; dy = 0; warp = 0.004; rot = 0.0;\r\nwarp_1=`#define sat saturate\r\nwarp_2=`sampler sampler_pw_noise_lq;\r\nwarp_3=`float streetx, streety,streetr,street; \r\nwarp_4=`float2 uv0, uv1, uv2, uv3;\r\nwarp_5=`static const float slim = 0.99;\r\nwarp_6=`\r\nwarp_7=`shader_body {\r\nwarp_8=`uv = uv_orig;\r\nwarp_9=`uv1 = (uv-.5);\r\nwarp_10=`uv2 = sin(uv*3.1416*2)/2;\r\nwarp_11=`//uv2 = abs(frac(2*uv-0.5)-0.5); \r\nwarp_12=` \r\nwarp_13=`float p1 = 100;\r\nwarp_14=`float p2 = 2;\r\nwarp_15=`streetx = 1- min(sat(p1*abs(uv2.x) -p2),sat(2*p1*abs(abs(uv1.x)-0.25)-p2)); \r\nwarp_16=`streety = 1- min(sat(p1*abs(uv2.y) -p2),sat(2*p1*abs(abs(uv1.y)-0.25)-p2));\r\nwarp_17=`streetr = 1- sat(p1*abs(rad/aspect.y*1.07-0.5) -p2*1.75);\r\nwarp_18=`\r\nwarp_19=`street = max(streetx,streety);\r\nwarp_20=`street = max(street,streetr);\r\nwarp_21=`\r\nwarp_22=`uv2 = (2*uv-0.5).yx;\r\nwarp_23=`float3 copy = GetPixel(uv2);\r\nwarp_24=`ret.r = lerp (0.05,copy,0.5) ;\r\nwarp_25=`\r\nwarp_26=`\r\nwarp_27=`//horizontale Fahrtrichtung\r\nwarp_28=`uv3 = uv_orig*texsize.xy*texsize_noise_lq.zw*float2(0.5,1);\r\nwarp_29=`uv3.x += (int(uv_orig.y*texsize_noise_lq.y)%8-4)*time*.015;\r\nwarp_30=`ret.b =  ((1*tex2D (sampler_pw_noise_lq, uv3).r) > 0.94)* (streety>slim) ;;\r\nwarp_31=`\r\nwarp_32=`//vertikale Fahrtrichtung\r\nwarp_33=`uv3 = uv_orig*texsize.xy*texsize_noise_lq.zw*float2(1,0.5);\r\nwarp_34=`uv3.y += (int(uv_orig.x*texsize_noise_lq.x)%8-4)*time*.023;\r\nwarp_35=`ret.b +=  ((1*tex2D (sampler_pw_noise_lq, uv3).r) > 0.94)* (streetx>slim) ;;\r\nwarp_36=`\r\nwarp_37=`\r\nwarp_38=`//Kreisverkehr\r\nwarp_39=`uv3 = float2 (rad/aspect.y*1.07, ang/4*2);\r\nwarp_40=`uv3.y += (int(uv3.x*32-12))*0.023*time;\r\nwarp_41=`ret.b +=  ((1*tex2D (sampler_pw_noise_lq, uv3).r) > 0.94) *(streetr>slim) * 0.8;;\r\nwarp_42=`\r\nwarp_43=`\r\nwarp_44=`//Lichter\r\nwarp_45=`ret.b += (frac(32*ret.r+q1+0.5*tex2D(sampler_pw_noise_lq,uv/2).r)>0.83) *0.8* !street *(ret.r < 0.12);\r\nwarp_46=`\r\nwarp_47=`ret.b += 0.1*street + 0.04;\r\nwarp_48=`ret.b = max (ret.b*1, GetPixel(uv_orig).b *0.74);\r\nwarp_49=`ret.r = ret.r*(1-street) ;\r\nwarp_50=`\r\nwarp_51=`}\r\ncomp_1=`sampler sampler_pw_noise_lq;\r\ncomp_2=`static const float quality = 5, depth = q30, z0=4;\r\ncomp_3=`static const float scale = 1.0/quality*depth/z0, d = length(texsize.zw);\r\ncomp_4=`float3 rsl, rsl0, rsl2, screen3, lights, lightcol, modmask;\r\ncomp_5=`float  lprof,dy, dy0, lav_gnd, laser, lg, tmp;\r\ncomp_6=`static const float3 mov = float3 (q5,q6, q7);\r\ncomp_7=`static const float3 t = float3(q14,q15,q16), s = float3(q17,q18,q19);\r\ncomp_8=`static const float3 ts = -cross(s,t), pos = float3 (q11,q12,q13);\r\ncomp_9=`static float2x3 tst = float2x3(ts,t);\r\ncomp_10=`\r\ncomp_11=`float3 project (float gnd) {  float z;\r\ncomp_12=`  z = -1/mul(cross(ts,-t),screen3) -gnd ;\r\ncomp_13=`  return z*float3(mul(tst,cross(pos,screen3))*aspect.yx,1);}\r\ncomp_14=`\r\ncomp_15=`shader_body {\r\ncomp_16=`//screen3 = float3 ((uv-float2(.5,.2))*aspect.xy,1.05-rad*rad/8);\r\ncomp_17=`screen3 = float3 ((uv-float2(.5,.3))*aspect.xy,1);\r\ncomp_18=`rsl0 = project (-depth) + mov;\r\ncomp_19=`\r\ncomp_20=`laser = .03; lg = -0.001; //Unsinn, aber 5fps schneller als lg=0\r\ncomp_21=`for (int m=0; m < 4; m++) {\r\ncomp_22=`  rsl2 = (project (lg)+mov);\r\ncomp_23=`//  tmp = 2.4* (length (frac(rsl2.xy) -0.5))-0.006;\r\ncomp_24=`  tmp = 3.6 *(q31%4+1)*q30* (length (frac(rsl2.xy) -0.5))-0.006;\r\ncomp_25=`  lg += tmp;\r\ncomp_26=`  laser = max(laser, 0.002/tmp*(sin(512*tmp+time*-32))) ;\r\ncomp_27=`}\r\ncomp_28=`\r\ncomp_29=`modmask = tex2D(sampler_noise_hq,rsl0.xy*.05);\r\ncomp_30=`lav_gnd = 0;\r\ncomp_31=`for (int m=0; m <= quality; m++) {\r\ncomp_32=`  rsl = (project (lav_gnd)+mov);\r\ncomp_33=`  lprof = floor(z0*1-2*z0*GetPixel(rsl.xy).r )*scale ;\r\ncomp_34=`  lav_gnd -= lprof;\r\ncomp_35=`}\r\ncomp_36=`rsl = project (lav_gnd)+ mov; \r\ncomp_37=`float streetlevel = saturate(-10*depth-12*lav_gnd);\r\ncomp_38=`float cmask = streetlevel > .01;\r\ncomp_39=`\r\ncomp_40=`lightcol = lerp (tex2D (sampler_noise_hq,rsl.xy/6), 0.5, 0.2);\r\ncomp_41=`lights = .07/length(cos(rsl.xy*24+modmask.yx*2))* lightcol;\r\ncomp_42=`dy = GetPixel(rsl.xy+d) - GetPixel(rsl.xy-d); dy0 = dy;\r\ncomp_43=`dy += (GetPixel(rsl*2+d) - GetPixel(rsl*2-d))/2 * !cmask;\r\ncomp_44=`ret = max(0,dy)*lights* (2+modmask.z*4);\r\ncomp_45=`ret += lights*saturate(0.2-8*lav_gnd*modmask.y)*4;\r\ncomp_46=`\r\ncomp_47=`ret += (.4+ret)*2*GetBlur1(frac(rsl0.xy)).b *saturate(streetlevel*2);\r\ncomp_48=`\r\ncomp_49=`float3 car = GetPixel(frac(rsl0.xy)).b;\r\ncomp_50=`if (GetPixel(rsl0.xy).r >0.02) {car *= tex2D(sampler_noise_lq,rsl0.xy*2);};\r\ncomp_51=`ret += car * cmask;\r\ncomp_52=`\r\ncomp_53=`float flash = frac(rsl.xy+dy);\r\ncomp_54=`ret += flash*saturate(1-8*lav_gnd)* q4 * float3(0.2,.5,1) ;\r\ncomp_55=`\r\ncomp_56=`ret += 8*GetBlur1(frac(rsl.xy)).g * (0.1+ret)*saturate(1-8*lav_gnd);\r\ncomp_57=`\r\ncomp_58=`//uncomment this line to disable lasers for higher performance\r\ncomp_59=`ret += saturate(laser)*0.8* saturate(1.5-lg) * float3 (q21,q22,q23);;\r\ncomp_60=`//ret = GetPixel(uv);\r\ncomp_61=`}\r\ncomp_62=`\r\ncomp_63=`written by martin\r\ncomp_64=`END\r\n"
}